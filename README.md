# 1. ê°•ì¢Œ ì†Œê°œ

- ì‹œì‘ì¼ 250407

## ê°•ì˜ ëª©í‘œ

- JPA ë‚´ë¶€ ë™ì‘ ë°©ì‹ ì´í•´
- JPA ê°€ ìƒì„±í•˜ëŠ” SQLì— ëŒ€í•´ ì´í•´
- JPA ê°€ ì–¸ì œ SQLì„ ì‹¤í–‰í•˜ëŠ”ì§€ì— ì´í•´

# 2. JPA ì†Œê°œ

## SQL ì¤‘ì‹¬ì ì¸ ê°œë°œì˜ ë¬¸ì œì 

- ì–´í”Œë¦¬ì¼€ì´ì…˜ì€ ê°ì²´ì§€í–¥
- ë°ì´í„°ë² ì´ìŠ¤ëŠ” ê´€ê³„í˜•
- ê°ì²´ë¥¼ ê´€ê³„í˜• DBì— ê´€ë¦¬í•˜ëŠ” ì‹œëŒ€

- ê°ì²´ì— í•„ë“œ ì¶”ê°€ ë³€ê²½ì‹œ, ëª¨ë“  ì¿¼ë¦¬ë¥¼ ë³€ê²½í•´ì•¼ í•¨
- ê´€ê³„í˜• DBë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìƒ SQLì— ì˜ì¡´ì ì¸ ê°œë°œì„ í•  ìˆ˜ ë°–ì— ì—†ë‹¤

### ê°ì²´ì™€ RDBSì˜ ì°¨ì´

- ìƒì†ì˜ ê°œë…ì´ ì—†ë‹¤.
  - ëª¨ë¸ë§ ê¸°ë²•ì¸Â **ìŠˆí¼íƒ€ì… ë° ì„œë¸Œíƒ€ì… ë„ì¶œ -** https://kkjsw17.tistory.com/12
- ì—°ê´€ê´€ê³„
  - ê°ì²´ëŠ” ì°¸ì¡°
  - í…Œì´ë¸”ì€ ì™¸ë˜í‚¤
- ê°ì²´ëŠ” ì°¸ì¡°ë¡œ íƒìƒ‰ê°€ëŠ¥(ê°ì²´ ê·¸ë˜í”„)
  - DAO ì¿¼ë¦¬ë¥¼ í™•ì¸ í•´ì•¼ í•œë‹¤.
- ê°ì²´ë‹µê²Œ ëª¨ë¸ë§ì„ í•˜ë©´ ë§¤í•‘ì‘ì—…ì´ ëŠ˜ì–´ë‚œë‹¤.

### ê°ì²´ë¥¼ ì»¬ë ‰ì…˜ì— ì €ì¥í•˜ë“¯ DBì— ì €ì¥í•˜ëŠ” ORM

## JPA ì†Œê°œ

- ORM: object relational mapping ê°ì²´ ê´€ê³„ ë§¤í•‘
- ê°ì²´ëŠ” ê°ì²´ëŒ€ë¡œì„¤ê³„
- DBëŠ” DBëŒ€ë¡œ ì„¤ê³„
- ORM í”„ë ˆì„ì›Œí¬ê°€ ì¤‘ê°„ì—ì„œ ë§¤í•‘

- JPAëŠ” APPê³¼ JDBC API ì‚¬ì´ì—ì„œ ë™ì‘
- EJB - entity bean(ìë°” í‘œì¤€)
- ê°œë¹ˆí‚¹ì˜ hibernate ì˜¤í”ˆ
- JPA(ìë°” í‘œì¤€) extends hibernate

## JPAëŠ” í‘œì¤€ ëª…ì„¸

- í‘œì¤€ëª…ì„¸ = ì¸í„°í˜ì´ìŠ¤ì˜ ëª¨ìŒ
- JPA 2.1 í‘œì¤€ëª…ì„¸ë¥¼ êµ¬í˜„í•œ 3ê°€ì§€ êµ¬í˜„ì²´
- í•˜ì´ë²„ë„¤ì´íŠ¸(90%ì´ìƒ), ì´í´ë¦½ìŠ¤ë§í¬, ë°ì´íƒ€ëˆ„í´ë¦¬ìŠ¤

## JPAë¥¼ ì™œ ì‚¬ìš©í•´ì•¼í•˜ëŠ”ê°€

- SQL ì¤‘ì‹¬ê°œë°œì—ì„œ ê°ì²´ì¤‘ì‹¬ê°œë°œ
- ìƒì‚°ì„±, ìœ ì§€ë³´ìˆ˜, ì„±ëŠ¥
- íŒ¨ëŸ¬ë‹¤ì„ ë¶ˆì¼ì¹˜ í•´ê²°
- í‘œì¤€

ê°’ ë³€ê²½í•˜ê³  saveí•˜ì§€ë§ê³  set ë©”ì„œë“œë§Œ ì‹¤í–‰í•´ë„ ê·¸ê²Œ dbì— ë°˜ì˜ì´ ëœë‹¤ê³ ??

ì´ê²ƒì´ **ë³€ê²½ ê°ì§€(Dirty Checking) ã„·ã„·**

## âœ… íŠ¸ëœì­ì…˜ì˜ ìƒëª…ì£¼ê¸° (Spring ê¸°ì¤€)

### ğŸ” ê¸°ë³¸ íë¦„:

1. `@Transactional` ë©”ì„œë“œ í˜¸ì¶œ (í”„ë¡ì‹œê°€ ê°ì§€)
2. íŠ¸ëœì­ì…˜ ì‹œì‘ (`begin transaction`)
3. ë©”ì„œë“œ ì‹¤í–‰
4. ë©”ì„œë“œê°€ ì •ìƒ ì¢…ë£Œ â†’ `commit`
5. ì˜ˆì™¸ ë°œìƒ ì‹œ â†’ `rollback`

## íŠ¸ëœì­ì…˜ì´ ëë‚˜ëŠ” ì‹œì ì€?

> âœ… @Transactional ë©”ì„œë“œì˜ ì‹¤í–‰ì´ ëë‚˜ê³ , Springì´ commit ë˜ëŠ” rollbackì„ ìˆ˜í–‰í•  ë•Œì…ë‹ˆë‹¤.

## íŒ¨ëŸ¬ë‹¤ì„ ë¶ˆì¼ì¹˜ í•´ê²°

1. JPAì™€ ìƒì†
2. ì—°ê´€ê´€ê³„
3. ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰
4. ë¹„êµí•˜ê¸°

## JPA ì„±ëŠ¥ ìµœì í™” ê¸°ëŠ¥

- 1ì°¨ ìºì‹œì™€ ë™ì¼ì„± ë³´ì¥ - ê°™ì€ íŠ¸ëœì­ì…˜ ì•ˆì—ì„œë§Œ
- íŠ¸ëœì§ì…˜ ì§€ì›í•˜ëŠ” ì§€ì—° ì“°ê¸°
- SQL ëª¨ì•„ë’€ë‹¤ê°€, ë°°ì¹˜ SQL ì²˜ë¦¬ ê°€ëŠ¥
- ì§€ì—° ë¡œë”©
  - ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ ì°¸ì¡°í• ë•Œ ì¡°íšŒ
- ì¦‰ì‹œ ë¡œë”©
  - ì—°ê´€ëœ ì—”í‹°í‹° ì „ë¶€ ì¡°íšŒ

ì™€ ë§¤í•‘ëœ ì—”í‹°í‹°ë„ í•œë²ˆì— ì¡°íšŒê°€ ë˜ëŠ”êµ¬ë‚˜!!!

ì¡°ì¸ì¿¼ë¦¬ ë‚ ë¦°ë‹¤ê³  queryDsl ì¨ë´¤ëŠ”ë°â€¦

### ORMì€ ê°ì²´ì™€ RDB ë‘ ê¸°ë‘¥ìœ„ì— ìˆëŠ” ê¸°ìˆ 

# 3. JPA ì‹œì‘í•˜ê¸°

## project ìƒì„±

- ì‚¬ìš©í•  ìŠ¤í”„ë§ ë¶€íŠ¸ ë²„ì „ì˜ docì„ ë³´ê³  ì ì ˆí•œ ë²„ì „ ì‚¬ìš©

## ì–´í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œ

- ë°©ì–¸: SQLí‘œì¤€ì´ ì•„ë‹Œ íŠ¹ì • DBì˜ ê³ ìœ ê¸°ëŠ¥

- dataë¥¼ ë³€ê²½í•˜ëŠ” ëª¨ë“ ì‘ì—…ì€ íŠ¸ëœì­ì…˜ì•ˆì—ì„œ ì‹¤í–‰í•´ì•¼í•œë‹¤.

### spring í”„ë¡œì íŠ¸ë¥¼ ì„¸íŒ…í–ˆëŠ”ë° member ì €ì¥ì´ ì•ˆëŒ

- Springì—ì„œ ì£¼ì…ë°›ëŠ” EntityManagerëŠ” **ìŠ¤í”„ë§ì´ ê´€ë¦¬í•˜ëŠ” Proxy(EntityManager)**
- ê·¸ë˜ì„œ ì§ì ‘ íŠ¸ëœì­ì…˜ì„ ìˆ˜ë™ìœ¼ë¡œ ì œì–´í•˜ë©´ ì•ˆëœë‹¤ í•¨
- `@Transactional` ì‚¬ìš©í•˜ë‹ˆ ëŒ

```java
// springì´ ì œì–´í•˜ëŠ” em ì£¼ì… ë°›ìŒ -> tx ìˆ˜ë™ì œì–´ ë¶ˆê°€
@PersistenceContext
private EntityManager em;

// EntityManagerFactoryë¥¼ ì£¼ì…ë°›ì•„ em ìƒì„±í•˜ë©´ ê°€ëŠ¥
@Autowired
private EntityManagerFactory emf;

    EntityManager em = emf.createEntityManager();
    EntityTransaction tx = em.getTransaction();

    try {
      tx.begin();
      //
      Member member = new Member();
      member.setName("HELLO");
      em.persist(member);
      //
      tx.commit();
    } catch (Exception e) {
      tx.rollback();
      e.printStackTrace();
    } finally {
      em.close();
    }

```

#### âœ… ì¤‘ìš” í¬ì¸íŠ¸ ìš”ì•½

| ì˜ëª»ëœ ë°©ì‹ (ìˆœìˆ˜ JPA ìŠ¤íƒ€ì¼)                 | ì˜¬ë°”ë¥¸ Spring ë°©ì‹                 |
| --------------------------------------------- | ---------------------------------- |
| `EntityTransaction tx = em.getTransaction()`  | `@Transactional`ìœ¼ë¡œ íŠ¸ëœì­ì…˜ ê´€ë¦¬ |
| `tx.begin()`, `tx.commit()` ìˆ˜ë™ í˜¸ì¶œ         | ìƒëµí•˜ê³  `@Transactional`ì— ë§¡ê¹€   |
| `Persistence.createEntityManagerFactory(...)` | `@PersistenceContext`ë¡œ ì£¼ì…ë°›ìŒ   |

---

#### ğŸ’¡ ì™œ Springì—ì„œ ì§ì ‘ íŠ¸ëœì­ì…˜ì„ ëª» ì—¬ëŠ”ê°€?

- `SharedEntityManager`ëŠ” **ThreadLocal ê¸°ë°˜**ì˜ Proxyì…ë‹ˆë‹¤.
- ì´ EntityManagerëŠ” ìŠ¤í”„ë§ì´ **íŠ¸ëœì­ì…˜ ë²”ìœ„ ë‚´ì—ì„œ ìë™ìœ¼ë¡œ ì—´ê³  ë‹«ì•„ì¤ë‹ˆë‹¤**.
- ì‚¬ìš©ìê°€ ì§ì ‘ `tx.begin()` ë“±ì„ í˜¸ì¶œí•˜ë©´ **ì»¨í…ìŠ¤íŠ¸ ë°–ì—ì„œ íŠ¸ëœì­ì…˜ì„ ì œì–´í•˜ë ¤ëŠ” ì‹œë„**ê°€ ë˜ì–´ ì˜ˆì™¸ê°€ ë°œìƒí•©ë‹ˆë‹¤.

---

#### ğŸ›  ì¶”ê°€ ê°œì„  íŒ

- `@Transactional`ì€ í´ë˜ìŠ¤ ë ˆë²¨ ë˜ëŠ” ë©”ì„œë“œ ë ˆë²¨ì—ì„œ ë¶™ì¼ ìˆ˜ ìˆì–´ìš”.
- ë‹¨, **`CommandLineRunner`ì—ì„œ ì‚¬ìš©í•  ë• ë°˜ë“œì‹œ `run()` ë©”ì„œë“œì— ë¶™ì—¬ì•¼ ì •ìƒ ë™ì‘**í•©ë‹ˆë‹¤.

### ğŸ“¦ ì •ë¦¬

```java
@Component
public class JpaRunner implements CommandLineRunner {

  @PersistenceContext
  private EntityManager em;

  @Override
  @Transactional
  public void run(String... args) throws Exception {
    System.out.println("JpaRunner START!!!!!");
    Member member = new Member();

    member.setId(1L);
    member.setName("hello");

    em.persist(member);

    System.out.println("JpaRunner END!!!!!");
  }
}
```

### ìˆ˜ì •

ì´ê±´ ì§„ì§œ ëŒ€ë°•ì´ë‹¤...

```java
Member member = em.find(Member.class, 1L);
member.setName("hello JPA");
```

### ì£¼ì˜

- ì—”í‹°í‹° ë§¤ë‹ˆì € íŒ©í† ë¦¬ëŠ” í•˜ë‚˜ë§Œ ìƒì„±í•´ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ì—ì„œ ê³µìœ 
- ì—”í‹°í‹° ë§¤ë‹ˆì €ëŠ” ì“°ë ˆë“œê°„ì— ê³µìœ X (ì‚¬ìš©í•˜ê³  ë²„ë ¤ì•¼ í•œë‹¤).
- JPAì˜ ëª¨ë“  ë°ì´í„° ë³€ê²½ì€ íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ ì‹¤í–‰
- DBëŠ” ë‹¤ íŠ¸ëœì­ì…˜ ê°œë…ì„ ê°€ì§€ê³  ìˆë‹¤

### JPQL ì†Œê°œ

- ê°€ì¥ ë‹¨ìˆœí•œ ì¡°íšŒ ë°©ë²•
- EntityManager.find()
- ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰(a.getB().getC())
- ë‚˜ì´ê°€ 18ì‚´ ì´ìƒì¸ íšŒì›ì„ ëª¨ë‘ ê²€ìƒ‰í•˜ê³  ì‹¶ë‹¤ë©´?

- ë‚´ê°€ ì›í•˜ë©´ ë°ì´í„°ë¥¼ ìµœì í™”í•´ì„œ ê°€ì ¸ì™€ì•¼í•˜ê³ , í†µê³„ì„± ì¿¼ë¦¬ë„ ë‚ ë ¤ì•¼í•¨
- ê¸°ìŠ¹ì „ ì¿¼ë¦¬

```java
// ê°€ì ¸ì˜¤ëŠ” ëŒ€ìƒì´ í…Œì´ë¸”ì´ ì•„ë‹ˆê³  ê°ì²´
List<Member> members = em.createQuery("select m from Member m", Member.class).getResultList();
```

- pagingì„ ì§€ì›í•˜ëŠ”ë°, DBì— ë§ê²Œ SQL ìƒì„±

### JPQLì´ í•„ìš”í•œ ì´ìœ 

- JPAë¥¼ ì‚¬ìš©í•˜ë©´ ì—”í‹°í‹° ê°ì²´ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ê°œë°œ
- ë¬¸ì œëŠ” ê²€ìƒ‰ ì¿¼ë¦¬
- ê²€ìƒ‰ì„ í•  ë•Œë„ í…Œì´ë¸”ì´ ì•„ë‹Œ ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê²€ìƒ‰
- ëª¨ë“  DB ë°ì´í„°ë¥¼ ê°ì²´ë¡œ ë³€í™˜í•´ì„œ ê²€ìƒ‰í•˜ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥
- ì• í”Œë¦¬ì¼€ì´ì…˜ì´ í•„ìš”í•œ ë°ì´í„°ë§Œ DBì—ì„œ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ ê²°êµ­ **ê²€ìƒ‰ ì¡°ê±´ì´ í¬í•¨ëœ SQLì´ í•„ìš”**

### JPQL

- JPAëŠ” SQLì„ ì¶”ìƒí™”í•œ JPQLì´ë¼ëŠ” ê°ì²´ ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ ì œê³µ
- SQLê³¼ ë¬¸ë²• ìœ ì‚¬, SELECT, FROM, WHERE, GROUP BY, HAVING, JOIN ì§€ì›
- JPQLì€ ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬
- SQLì€ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì„ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬
- í…Œì´ë¸”ì´ ì•„ë‹Œ ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê²€ìƒ‰í•˜ëŠ” ê°ì²´ ì§€í–¥ ì¿¼ë¦¬
- SQLì„ ì¶”ìƒí™”í•´ì„œ íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ SQLì— ì˜ì¡´X
- JPQLì„ í•œë§ˆë””ë¡œ ì •ì˜í•˜ë©´ ê°ì²´ ì§€í–¥ SQL

# 4. ì˜ì†ì„± ê´€ë¦¬ - ë‚´ë¶€ ë™ì‘ ë°©ì‹

## ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ 1

### JPAì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ 2ê°€ì§€

- Objectì™€ RDB ë§¤í•‘ ORM
  - DBì™€ ê°ì²´ê°€ ì˜ ì—°ë™ ë  ìˆ˜ ìˆê²Œ ì„¤ê³„
- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸(persistance context)

  - JPAê°€ ë‚´ë¶€ì ìœ¼ë¡œ ë™ì‘í•˜ëŠ” ë°©ì‹

- ì—”í‹°í‹°ë§¤ë‹ˆì €íŒ©í† ë¦¬ì™€ ì—”í‹°í‹°ë§¤ë‹ˆì €
- ì—”í‹°í‹°ë§¤ë‹ˆì €íŒ©í† ë¦¬ëŠ” ìš”ì²­ì„ ë°›ìœ¼ë©´ ì—”í‹°í‹° ë§¤ë‹ˆì €ë¥¼ ìƒì„±
- ì—”í‹°í‹°ë§¤ë‹ˆì €ëŠ” DB ì»¤ë„¥ì…˜ì„ ì‚¬ìš©í•¨

- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸: ì—”í‹°í‹°ë¥¼ ì˜êµ¬ì €ì¥í•˜ëŠ” í™˜ê²½

  - persist ë©”ì„œë“œëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥í•œë‹¤ëŠ” ì˜ë¯¸

- ì—”í‹°í‹° ë¼ì´í”„ì‚¬ì´í´

  - ë¹„ì˜ì†: ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì™€ ê´€ê³„ì—†ìŒ
  - ì˜ì†: ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥ë˜ì–´ ê´€ë¦¬ë˜ëŠ” ìƒíƒœ // persist
  - ì¤€ì˜ì†: ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ë¶„ë¦¬ëœ ìƒíƒœ // detech
  - ì‚­ì œ: ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì‚­ì œ // remove

- ê°ì²´ê°€ ì˜ì†ìƒíƒœê°€ ëœë‹¤ê³ í•´ì„œ ë°”ë¡œ DBì— ì¿¼ë¦¬ì— ë‚ ë¼ê°€ëŠ”ê²Œ ì•„ë‹ˆë¼, íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•˜ëŠ” ì‹œì 

### ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ì´ì 

- 1ì°¨ ìºì‹œ
- ë™ì¼ì„± ë³´ì¥
- íŠ¸ëœì­ì…˜ì„ ë³´ì¥í•˜ëŠ” ì“°ê¸°ì§€ì—°
- ë³€ê²½ ê°ì§€(dirty checking)
- ì§€ì—° ë¡œë”©(lazy loading)

## ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ 2

### ì—”í‹°í‹° ì¡°íšŒ, 1ì°¨ ìºì‹œ

- ì¡°íšŒí• ë•Œ, ì»¨í…ìŠ¤íŠ¸ë¶€í„° í™•ì¸í•´ì„œ ìˆë‹¤ë©´ DBê¹Œì§€ ê°€ì§€ì•ŠëŠ”ë‹¤
  - react-queryë‘ êµ‰ì¥íˆ ìœ ì‚¬
- 1ì°¨ ìºì‹œëŠ” í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ì—ì„œë§Œ ìœ íš¨í•˜ë‹¤.

  - ë‹¤ë¥¸ ìš”ì²­ìœ¼ë¡œ ì¸í•œ íŠ¸ëœì­ì…˜ê³¼ ê°™ì€ ìºì‹œë¥¼ ê³µìœ í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì˜ë¯¸
  - JPAì—ì„œ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ì—ì„œ ê³µìœ í•˜ëŠ” ìºì‹œëŠ” 2ì°¨ ìºì‹œ
  - ê·¸ë ‡ê¸°ì— ìœ ì˜ë¯¸í•œ ì„±ëŠ¥ì´ì ì€ ì—†ë‹¤.

- ë°ì´í„°ë¥¼ ë§¤ë²ˆ DBì—ì„œ ì½ì§€ ì•Šê³ , ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë©”ëª¨ë¦¬ì— ë³´ê´€í•´ë‘ê³  ì‚¬ìš©í•˜ëŠ” ë°©ì‹(1ì°¨ ìºì‹œ)ì„ í†µí•´,
- íŠ¸ëœì­ì…˜ ë™ì•ˆ ê°™ì€ ë°ì´í„°ë¥¼ ë°˜ë³µí•´ì„œ ì½ì–´ë„ ê°’ì´ ë³€í•˜ì§€ ì•Šë„ë¡ ë³´ì¥í•˜ëŠ” ê²ƒ. ì´ê±¸ DB ì„¤ì • ì—†ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ë¶€ì—ì„œ êµ¬í˜„í•œ ê²ƒì´ë‹¤."
  - íŠ¸ëœì­ì…˜ ê²©ë¦¬ ìˆ˜ì¤€:REPEATABLE READ
    - íŠ¸ëœì­ì…˜ ê²©ë¦¬ = DBì—ì„œ ë™ì‹œì— ì—¬ëŸ¬ ì‘ì—…ì´ ì¼ì–´ë‚  ë•Œ, ë°ì´í„°ì˜ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ ê²©ë¦¬ ìˆ˜ì¤€ì„ ì„¤ì •
    - REPEATABLE READ = "íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ë™ì¼í•œ ë°ì´í„°ë¥¼ ì—¬ëŸ¬ ë²ˆ ì½ì–´ë„ ê°’ì´ ë³€í•˜ì§€ ì•Šë„ë¡ ë³´ì¥"í•˜ëŠ” ë“±ê¸‰

### ì—”í‹°í‹° ë“±ë¡ - ì“°ê¸° ì§€ì—°

- JPAì—ì„œëŠ” ë°ì´í„° ë³€ê²½ì´ ë°˜ë“œì‹œ íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ ì´ë£¨ì–´ì ¸ì•¼ í•˜ë©°, ì—”í‹°í‹° ë§¤ë‹ˆì €ëŠ” ë³€ê²½ ë‚´ìš©ì„ ì¦‰ì‹œ DBì— ë°˜ì˜í•˜ì§€ ì•ŠëŠ”ë‹¤.
- íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì§ì „ì— flush()ë¥¼ í†µí•´ SQLì„ í•œêº¼ë²ˆì— ì „ì†¡í•œë‹¤.
- HibernateëŠ” ì´ ê³¼ì •ì—ì„œ JDBC Batch ê¸°ëŠ¥ì„ í™œìš©í•´ SQLë“¤ì„ ë²„í¼ì— ëª¨ì•˜ë‹¤ê°€, ì—¬ëŸ¬ ì¿¼ë¦¬ë¥¼ í•œ ë²ˆì— ì²˜ë¦¬í•  ìˆ˜ ìˆì–´ ì„±ëŠ¥ì„ ìµœì í™”í•œë‹¤.

- JPAëŠ” ê°ì²´ë¥¼ ë§Œë“¤ ë•Œ ë¦¬í”Œë ‰ì…˜(Reflection)ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì—, ë°˜ë“œì‹œ ê¸°ë³¸ ìƒì„±ì(íŒŒë¼ë¯¸í„° ì—†ëŠ” ìƒì„±ì)ê°€ í•„ìš”í•˜ë‹¤.

  - ë‚´ë¶€ì ìœ¼ë¡œ ë¦¬í”Œë ‰ì…˜ì„ í†µí•´ ê°ì²´ë¥¼ ë§Œë“¤ê³  í•„ë“œì— ê°’ì„ ì±„ì›€
  - ì´ë•Œ ë¦¬í”Œë ‰ì…˜ì€ ê¸°ë³¸ ìƒì„±ìê°€ ìˆì–´ì•¼ë§Œ ê°ì²´ë¥¼ ìƒì„±

- JPAì˜ ëª©ì ì€ ì»¬ë ‰ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì²˜ëŸ¼ ê°ì²´ë¥¼ ë‹¤ë£¨ëŠ” ê²ƒ

  - ì»¬ë ‰ì…˜ì—ì„œ ë°ì´í„°ë¥¼ ë³€ê²½í–ˆë‹¤ë©´, ë³€ê²½ì´ ë˜ì–´ì•¼ í•¨

- ì»¤ë°‹ì„ í•˜ë©´ ë‚´ë¶€ì ìœ¼ë¡œ flushê°€ í˜¸ì¶œ ë¨
- 1ì°¨ ìºì‹œì—ëŠ” ì—”í‹°í‹°ì™€, ìŠ¤ëƒ…ìƒ·(ìµœì´ˆë¡œ 1ì°¨ìºì‹œì— ë“¤ì–´ì˜¨ ì‹œì ì˜ ë°ì´í„°)
- ê°’ì„ ì „ë¶€ ë¹„êµ

- ë¦¬í”Œë ‰ì…˜: ëŸ°íƒ€ì„ì— í´ë˜ìŠ¤, ë©”ì„œë“œ, í•„ë“œ ë“± ê°ì²´ì˜ êµ¬ì¡°ë¥¼ ì¡°ì‚¬í•˜ê³  ì¡°ì‘

  - ê¸°ëŠ¥
    - í´ë˜ìŠ¤ ì´ë¦„, í•„ë“œ ëª©ë¡, ë©”ì„œë“œ ëª©ë¡ì„ ëŸ°íƒ€ì„ì— ì¡°íšŒ
    - ì ‘ê·¼ ì œí•œ(private ë“±)ì„ ë¬´ì‹œí•˜ê³  í•„ë“œë‚˜ ë©”ì„œë“œì— ì ‘ê·¼
    - ê°ì²´ì˜ í´ë˜ìŠ¤ íƒ€ì…ì„ ëª¨ë¥´ë”ë¼ë„ ë™ì ìœ¼ë¡œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±
  - ê¸°ë³¸ íë¦„:
    1. í´ë˜ìŠ¤ ë¡œë”©
    2. Class ê°ì²´ ìƒì„±
    3. ë¦¬í”Œë ‰ì…˜ APIë¡œ í•„ë“œ/ë©”ì„œë“œ/ìƒì„±ì ì¡°ì‚¬
    4. í•„ìš”í•˜ë©´ setAccessible(true)ë¡œ private ì ‘ê·¼ ë¬´ì‹œ
    5. ê°’ì„ ì½ê±°ë‚˜ ì„¤ì •í•˜ê±°ë‚˜, ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±
  - ë‹¨ì 
    - ì„±ëŠ¥ ì €í•˜ - ë¦¬í”Œë ‰ì…˜ì€ ì¼ë°˜ ì½”ë“œë³´ë‹¤ ëŠë¦¼ (ìµœì í™” ì–´ë ¤ì›€)
    - íƒ€ì… ì•ˆì •ì„± ë‚®ìŒ - ì»´íŒŒì¼ íƒ€ì„ì— íƒ€ì… ì²´í¬ê°€ ì•ˆ ë¨ (ëŸ°íƒ€ì„ ì˜¤ë¥˜ ê°€ëŠ¥)
    - ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€ - ì½”ë“œ íë¦„ ì¶”ì ì´ ì–´ë ¤ì›€, ë¦¬íŒ©í† ë§ ì–´ë ¤ì›€
  - ì¼ë°˜ ë¡œì§ì—ì„œëŠ” ì˜ ì•ˆ ì“°ê³ , í”„ë ˆì„ì›Œí¬ë‚˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ìˆ˜ì¤€ì—ì„œ ì£¼ë¡œ ì‚¬ìš©

## í”ŒëŸ¬ì‹œ

- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ë³€ê²½ë‚´ìš©ì„ DBì— ë°˜ì˜í•˜ëŠ” ê²ƒ
  - ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ë¹„ìš°ëŠ” ê²ƒì´ ì•„ë‹˜
- íŠ¸ëœì­ì…˜ì´ë¼ëŠ” ì‘ì—…ë‹¨ìœ„ê°€ ì¤‘ìš”í•˜ë‹¤ - ì»¤ë°‹ì§ì „ì—ë§Œ ë™ê¸°í™”í•˜ë©´ ë¨

### í”ŒëŸ¬ì‹œ ë°œìƒ

- ë³€ê²½ ê°ì§€
- ì—”í‹°í‹° ìˆ˜ì •
  - (ì“°ê¸° ì§€ì—° SQL ì €ì¥ì†Œì— ë“±ë¡)
- SQL ì €ì¥ì†Œì˜ ì¿¼ë¦¬ë¥¼ DBì— ì „ì†¡

### ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ í”ŒëŸ¬ì‹œ í•˜ëŠ” ë²•

- em.flush() - ì§ì ‘ í˜¸ì¶œ
- tx.commit() - ìë™ í˜¸ì¶œ
- JPQL query - ìë™ í˜¸ì¶œ

### flush mode

- auto: commit or query ì‹¤í–‰ ì‹œ flush(ê¸°ë³¸)
- commit: commitë§Œ flush

## ì¤€ì˜ì† ìƒíƒœ

- ì˜ì†ìƒíƒœì˜ ì—”í‹°í‹°ë¥¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ë¶„ë¦¬

### ì¤€ì˜ì†ìƒíƒœë¡œ ë§Œë“œëŠ” ë²•

- em.detach(): íŠ¹ì • ì—”í‹°í‹°ë§Œ
- em.clear(): ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
- em.close(): ì»¨í…ìŠ¤íŠ¸ ì¢…ë£Œ

# 5. ì—”í‹°í‹° ë§¤í•‘

## ê°ì²´ì™€ í…Œì´ë¸” ë§¤í•‘

- ê°ì²´ì™€ í…Œì´ë¸” ë§¤í•‘: @`Entity`, `@Table`
- í•„ë“œì™€ ì»¬ëŸ¼ ë§¤í•‘: `@Column`
- ê¸°ë³¸ í‚¤ ë§¤í•‘: `@Id`
- ì—°ê´€ê´€ê³„ ë§¤í•‘: `@ManyToOne`,`@JoinColumn`

### @Entity

- @Entityê°€ ë¶™ì€ í´ë˜ìŠ¤ëŠ” JPAê°€ ê´€ë¦¬, ì—”í‹°í‹°ë¼ í•œë‹¤.
- JPAë¥¼ ì‚¬ìš©í•´ì„œ í…Œì´ë¸”ê³¼ ë§¤í•‘í•  í´ë˜ìŠ¤ëŠ” @Entity í•„ìˆ˜
- ì£¼ì˜
  - ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜(íŒŒë¼ë¯¸í„°ê°€ ì—†ëŠ” public ë˜ëŠ” protected ìƒì„±ì)
  - final í´ë˜ìŠ¤, enum, interface, inner í´ë˜ìŠ¤ ì‚¬ìš©X
  - ì €ì¥í•  í•„ë“œì— final ì‚¬ìš© X

### @Entity ì†ì„± ì •ë¦¬

- ì†ì„±: name
- JPAì—ì„œ ì‚¬ìš©í•  ì—”í‹°í‹° ì´ë¦„ì„ ì§€ì •í•œë‹¤.
- ê¸°ë³¸ê°’: í´ë˜ìŠ¤ ì´ë¦„ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©(ì˜ˆ: Member)
- ê°™ì€ í´ë˜ìŠ¤ ì´ë¦„ì´ ì—†ìœ¼ë©´ ê°€ê¸‰ì  ê¸°ë³¸ê°’ì„ ì‚¬ìš©í•œë‹¤.

- @Tableì€ ì—”í‹°í‹°ì™€ ë§¤í•‘í•  í…Œì´ë¸” ì§€ì •

## ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„±

- DDLì„ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œì ì— ìë™ ìƒì„±
- í…Œì´ë¸” ì¤‘ì‹¬ -> ê°ì²´ ì¤‘ì‹¬
- ë°ì´í„°ë² ì´ìŠ¤ ë°©ì–¸ì„ í™œìš©í•´ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— ë§ëŠ” ì ì ˆí•œ DDL ìƒì„±
- ì´ë ‡ê²Œ ìƒì„±ëœ DDLì€ ê°œë°œ ì¥ë¹„ì—ì„œë§Œ ì‚¬ìš©
- ìƒì„±ëœ DDLì€ ìš´ì˜ì„œë²„ì—ì„œëŠ” ì‚¬ìš©í•˜ì§€ ì•Šê±°ë‚˜, ì ì ˆíˆ ë‹¤ë“¬ì€ í›„ ì‚¬ìš©

### ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„± - ì†ì„±

`hibernate.ddl-auto`

- create: ê¸°ì¡´í…Œì´ë¸” ì‚­ì œ í›„ ë‹¤ì‹œ ìƒì„± (DROP + CREATE)
- create-drop: createì™€ ê°™ìœ¼ë‚˜ ì¢…ë£Œì‹œì ì— í…Œì´ë¸” DROP
- update: ë³€ê²½ë¶„ë§Œ ë°˜ì˜(ìš´ì˜DBì—ëŠ” ì‚¬ìš©í•˜ë©´ ì•ˆë¨)
- validate: ì—”í‹°í‹°ì™€ í…Œì´ë¸”ì´ ì •ìƒ ë§¤í•‘ë˜ì—ˆëŠ”ì§€ë§Œ í™•ì¸
- none: ì‚¬ìš©í•˜ì§€ ì•ŠìŒ(ê´€ë¡€ìƒ)

### ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„± - ì£¼ì˜

- **ìš´ì˜ ì¥ë¹„ì—ëŠ” ì ˆëŒ€ create, create-drop, update ì‚¬ìš©í•˜ë©´ ì•ˆëœë‹¤.**
- ê°œë°œ ì´ˆê¸° ë‹¨ê³„ëŠ” create ë˜ëŠ” update
- í…ŒìŠ¤íŠ¸ ì„œë²„ëŠ” update ë˜ëŠ” validate
- **ìŠ¤í…Œì´ì§•ê³¼ ìš´ì˜ ì„œë²„ëŠ” validate ë˜ëŠ” none**

- **ë¡œì»¬ì•„ë‹ˆë©´ ê·¸ëƒ¥ ì“°ì§€ë§ˆë¼!!!**
- **ìŠ¤í¬ë¦½íŠ¸ì§œì„œ ì§ì ‘ ì ìš©í•´ë¼**
- alter queryëŠ” í•´ë‹¹ í…Œì´ë¸”ì— ë½ì´ ê±¸ë¦¬ëŠ”ë°, ê·¸ë™ì•ˆ ì„œë¹„ìŠ¤ê°€ ì¤‘ë‹¨ë  ìˆ˜ ìˆë‹¤.

### DDL ìƒì„± ê¸°ëŠ¥

- ì œì•½ì¡°ê±´ ì¶”ê°€: íšŒì› ì´ë¦„ì€ í•„ìˆ˜, 10ì ì´ˆê³¼X
- @Column(nullable = false, length = 10)
- ìœ ë‹ˆí¬ ì œì•½ì¡°ê±´ ì¶”ê°€
- @Table(uniqueConstraints = {@UniqueConstraint( name = "NAME_AGE_UNIQUE",
  columnNames = {"NAME", "AGE"} )})
- DDL ìƒì„± ê¸°ëŠ¥ì€ DDLì„ ìë™ ìƒì„±í•  ë•Œë§Œ ì‚¬ìš©ë˜ê³ 
  JPAì˜ ì‹¤í–‰ ë¡œì§ì—ëŠ” ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ”ë‹¤.

### âœ… ìš´ì˜ í™˜ê²½ì—ì„œ ìŠ¤í‚¤ë§ˆ ë³€ê²½í•˜ëŠ” ë°©ë²•

#### 1. **DDL ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì‘ì„±í•˜ê±°ë‚˜ ìë™ ìƒì„±**

- ê°œë°œ í™˜ê²½ì—ì„œ `create` ë˜ëŠ” `update` ì˜µì…˜ì„ ì„¤ì •í•˜ê³  í…ŒìŠ¤íŠ¸ DBì—ì„œ Hibernateê°€ ìƒì„±í•œ DDLì„ í™•ì¸
- `spring.jpa.show-sql=true`, `spring.jpa.properties.hibernate.format_sql=true` ì˜µì…˜ìœ¼ë¡œ ì¿¼ë¦¬ ë¡œê·¸ë¥¼ ì˜ˆì˜ê²Œ ì¶œë ¥
- ë˜ëŠ” `schema-generation.scripts.create-target` ì˜µì…˜ì„ ì¨ì„œ Hibernateë¡œë¶€í„° DDL ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìƒì„± ê°€ëŠ¥

```properties
spring.jpa.generate-ddl=true
spring.jpa.hibernate.ddl-auto=none
spring.jpa.properties.javax.persistence.schema-generation.scripts.action=create
spring.jpa.properties.javax.persistence.schema-generation.scripts.create-target=ddl/create.sql
```

---

#### 2. **DBA ë˜ëŠ” ê°œë°œìê°€ ì§ì ‘ ìŠ¤í¬ë¦½íŠ¸ ê²€í† **

- í…Œì´ë¸” ë½, ì¸ë±ìŠ¤ ìƒì„± ë¹„ìš© ë“± ê³ ë ¤
- ìœ„í—˜í•œ `alter table`ì€ ì—…ë¬´ ì‹œê°„ ì™¸ë‚˜ ë°°í¬ì°½êµ¬ì—ì„œ ì‹¤í–‰
- ìŠ¤í¬ë¦½íŠ¸ëŠ” í˜•ìƒê´€ë¦¬(Git ë“±)ì— í¬í•¨

---

#### 3. **ë²„ì „ ê´€ë¦¬ ë„êµ¬ ì‚¬ìš© (ğŸ› ï¸ ì¶”ì²œ!)**

**[Flyway](https://flywaydb.org/) ë˜ëŠ” Liquibase**ë¥¼ ì´ìš©í•˜ë©´ ìŠ¤í‚¤ë§ˆ ë³€ê²½ì„ ì½”ë“œì²˜ëŸ¼ ê´€ë¦¬ ê°€ëŠ¥

#### ì˜ˆ: Flyway

- `resources/db/migration` í´ë”ì— `V1__create_user_table.sql`ì²˜ëŸ¼ ì‘ì„±
- ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ ìë™ ì ìš©ë˜ê±°ë‚˜, CLI/CIì—ì„œ ìˆ˜ë™ ì ìš©

### ğŸ‘‰ ì‹¤ë¬´ì—ì„œëŠ” ë‹¤ìŒì„ ì¶”ì²œ

- ê°œë°œ ë‹¨ê³„ì—ì„œ DDL ë¯¸ë¦¬ í™•ì¸
- ë³€ê²½ ì‚¬í•­ì„ DDLë¡œ ì‘ì„±
- Flyway/Liquibase ê°™ì€ ë„êµ¬ë¡œ ê´€ë¦¬
- ìš´ì˜ ë°°í¬ ì „ì— DBAì™€ ë¦¬ë·° ë° í…ŒìŠ¤íŠ¸

## í•„ë“œì™€ ì»¬ëŸ¼ ë§¤í•‘

### ë§¤í•‘ ì–´ë…¸í…Œì´ì…˜ ì •ë¦¬

- `@Column`: ì»¬ëŸ¼ ë§¤í•‘
- `@Temporal`: ë‚ ì§œ íƒ€ì… ë§¤í•‘
- `@Enumerated`: enum íƒ€ì… ë§¤í•‘
- `@Lob`: BLOB, CLOB ë§¤í•‘
- `@Transient`: íŠ¹ì • í•„ë“œë¥¼ ì»¬ëŸ¼ì— ë§¤í•‘í•˜ì§€ ì•ŠìŒ(ë§¤í•‘ ë¬´ì‹œ) - ë©”ëª¨ë¦¬ì—ì„œë§Œ ì‚¬ìš©

### @Column

- name: í•„ë“œì™€ ë§¤í•‘í•  í…Œì´ë¸”ì˜ ì»¬ëŸ¼ ì´ë¦„ ê°ì²´ì˜ í•„ë“œ ì´ë¦„
- insertable,updatable: ë“±ë¡, ë³€ê²½ ê°€ëŠ¥ ì—¬ë¶€
- nullable(DDL) null ê°’ì˜ í—ˆìš© ì—¬ë¶€ë¥¼ ì„¤ì •í•œë‹¤.
  - falseë¡œ ì„¤ì •í•˜ë©´ DDL ìƒì„± ì‹œì— not null ì œì•½ì¡°ê±´ì´ ë¶™ëŠ”ë‹¤.
- unique(DDL) @Tableì˜ uniqueConstraintsì™€ ê°™ì§€ë§Œ í•œ ì»¬ëŸ¼ì— ê°„ë‹¨íˆ ìœ ë‹ˆí¬ ì œì•½ì¡°ê±´ì„ ê±¸ ë•Œ ì‚¬ìš©í•œë‹¤.
- columnDefinition(DDL) ë°ì´í„°ë² ì´ìŠ¤ ì»¬ëŸ¼ ì •ë³´ë¥¼ ì§ì ‘ ì¤„ ìˆ˜ ìˆë‹¤.
  - ex) varchar(100) default â€˜EMPTY'
- length(DDL) ë¬¸ì ê¸¸ì´ ì œì•½ì¡°ê±´, String íƒ€ì…ì—ë§Œ ì‚¬ìš©í•œë‹¤.
  - 255
- precision,scale(DDL): BigDecimal íƒ€ì…ì—ì„œ ì‚¬ìš©í•œë‹¤(BigIntegerë„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤).
  - precisionì€ ì†Œìˆ˜ì ì„ í¬í•¨í•œ ì „ì²´ ì ë¦¿ìˆ˜ë¥¼, scaleì€ ì†Œìˆ˜ì˜ ìë¦¿ìˆ˜
  - ì°¸ê³ ë¡œ double, float íƒ€ì…ì—ëŠ” ì ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤. ì•„ì£¼ í° ìˆ«ìë‚˜ ì •ë°€í•œ ì†Œìˆ˜ë¥¼ ë‹¤ë£¨ì–´ì•¼ í•  ë•Œë§Œ ì‚¬ìš©í•œë‹¤.
  - precision=19,scale=2

### @Enumerated

- ìë°” enum íƒ€ì…ì„ ë§¤í•‘í•  ë•Œ ì‚¬ìš©
- ì£¼ì˜! ORDINAL ì‚¬ìš©X
- EnumType.ORDINAL: enum ìˆœì„œë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥(ê¸°ë³¸ê°’)
- EnumType.STRING: enum ì´ë¦„ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥

### @Temporal

- ë‚ ì§œ íƒ€ì…(java.util.Date, java.util.Calendar)ì„ ë§¤í•‘í•  ë•Œ ì‚¬ìš©
  - ê³¼ê±°
- LocalDate(ë‚ ì§œë§Œ), LocalDateTime(ë‚ ì§œ + ì‹œê°„), Instant(íƒ€ì„ìŠ¤íƒ¬í”„)ì„ ì‚¬ìš©í•  ë•ŒëŠ” ìƒëµ ê°€ëŠ¥(ìµœì‹  í•˜ì´ë²„ë„¤ì´íŠ¸ ì§€ì›)
  - ê¶Œì¥ íƒ€ì…

### @Lob

- ë°ì´í„°ë² ì´ìŠ¤ BLOB, CLOB íƒ€ì…ê³¼ ë§¤í•‘
- @Lobì—ëŠ” ì§€ì •í•  ìˆ˜ ìˆëŠ” ì†ì„±ì´ ì—†ë‹¤.
- ë§¤í•‘í•˜ëŠ” í•„ë“œ íƒ€ì…ì´ ë¬¸ìë©´ CLOB ë§¤í•‘, ë‚˜ë¨¸ì§€ëŠ” BLOB ë§¤í•‘
- CLOB: String, char[], java.sql.CLOB
- BLOB: byte[], java.sql. BLOB

### @Transient

- í•„ë“œ ë§¤í•‘X

## ê¸°ë³¸ í‚¤ ë§¤í•‘

### ê¸°ë³¸ í‚¤ ë§¤í•‘ ì–´ë…¸í…Œì´ì…˜

- @Id
  - ì§ì ‘ í• ë‹¹
- @GeneratedValue
  - ìë™í• ë‹¹
  - IDENTITY: ë°ì´í„°ë² ì´ìŠ¤ì— ìœ„ì„, MYSQL(auto increament)
  - SEQUENCE: ë°ì´í„°ë² ì´ìŠ¤ ì‹œí€€ìŠ¤ ì˜¤ë¸Œì íŠ¸ ì‚¬ìš©, ORACLE
  - @SequenceGenerator í•„ìš”
  - TABLE: í‚¤ ìƒì„±ìš© í…Œì´ë¸” ì‚¬ìš©, ëª¨ë“  DBì—ì„œ ì‚¬ìš©
  - @TableGenerator í•„ìš”
  - AUTO: ë°©ì–¸ì— ë”°ë¼ ìë™ ì§€ì •, ê¸°ë³¸ê°’

### ê¶Œì¥í•˜ëŠ” ì‹ë³„ì ì „ëµ

- ê¸°ë³¸ í‚¤ ì œì•½ ì¡°ê±´:
  - null ì•„ë‹˜,
  - ìœ ì¼,
  - ë³€í•˜ë©´ ì•ˆëœë‹¤.
- ë¯¸ë˜ê¹Œì§€ ì´ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ìì—°í‚¤ëŠ” ì°¾ê¸° ì–´ë µë‹¤.
  - ëŒ€ë¦¬í‚¤(ëŒ€ì²´í‚¤)ë¥¼ ì‚¬ìš©í•˜ì.
  - ë¹„ì¦ˆë‹ˆìŠ¤ì™€ ìƒê´€ì—†ëŠ” ê°’ì„ ì‚¬ìš©í•˜ë¼
  - ì˜ˆë¥¼ ë“¤ì–´ ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ë„ ê¸°ë³¸ í‚¤ë¡œ ì ì ˆí•˜ê¸° ì•Šë‹¤.
- ê¶Œì¥: Longí˜• + ëŒ€ì²´í‚¤ + í‚¤ ìƒì„±ì „ëµ ì‚¬ìš©
  - ìŠ¤ë…¸ìš° í”Œë ˆì´í¬

### IDENTITY ì „ëµ - íŠ¹ì§•

- ê¸°ë³¸ í‚¤ ìƒì„±ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ìœ„ì„
- ì£¼ë¡œ MySQL, PostgreSQL, SQL Server, DB2ì—ì„œ ì‚¬ìš© (ì˜ˆ: MySQLì˜ AUTO_INCREMENT)
- JPAëŠ” ë³´í†µ íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œì ì— INSERT SQL ì‹¤í–‰
- AUTO_INCREMENTëŠ” **ë°ì´í„°ë² ì´ìŠ¤ì— INSERT SQLì„ ì‹¤í–‰í•œ ì´í›„ì— ID ê°’ì„ ì•Œ ìˆ˜ ìˆìŒ**
- IDENTITY ì „ëµì€ em.persist() ì‹œì ì— ì¦‰ì‹œ **INSERT SQL ì‹¤í–‰í•˜ê³  DBì—ì„œ ì‹ë³„ìë¥¼ ì¡°íšŒ**
  - insert ì‹œì ì— idë¥¼ jdbc driverì—ì„œ ì•Œë ¤ì¤Œ(ì¶”ê°€ì  select í•„ìš”x)
- **ëª¨ì•„ì„œ insertí•˜ëŠ”ê²Œ ë¶ˆê°€ëŠ¥**
  - ì¼ë°˜ì ìœ¼ë¡œ ì„±ëŠ¥ì— ìœ ì˜ë¯¸í•œ ë‹¨ì ì€ ì•„ë‹ˆë‹¤.

### SEQUENCE ì „ëµ - íŠ¹ì§•

- ë°ì´í„°ë² ì´ìŠ¤ ì‹œí€€ìŠ¤ëŠ” ìœ ì¼í•œ ê°’ì„ ìˆœì„œëŒ€ë¡œ ìƒì„±í•˜ëŠ” íŠ¹ë³„í•œ ë°ì´í„°ë² ì´ìŠ¤ ì˜¤ë¸Œì íŠ¸(ì˜ˆ: ì˜¤ë¼í´ ì‹œí€€ìŠ¤)
- ì˜¤ë¼í´, PostgreSQL, DB2, H2 ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš©
- ë¯¸ë¦¬ ì‹œí€€ìŠ¤í…Œì´ë¸”ì—ì„œ next pk ë°›ì•„ì˜´
- ê·¸ í›„ commit ì‹œì ì— flush
- ì‹œí€€ìŠ¤ í…Œì´ë¸”ì—ì„œ ë§¤ë²ˆ ë°›ì•„ì˜¤ëŠ” ë¶€ë¶„ì„ ìµœì í™”
  - í•œë²ˆì˜ ìš”ì²­ìœ¼ë¡œ allocationSize(ê¸°ë³¸ê°’ 50)ë§Œí¼, ë‹¤ìŒ pkë¥¼ ë¯¸ë¦¬ ë°›ì•„ì˜´
  - ì¦‰, DB ì‹œí€€ìŠ¤ëŠ” 1, 2, 3, â€¦ í•˜ë‚˜ì”©ë§Œ ì˜¬ë¼ê°€ì§€ë§Œ, HibernateëŠ” ê·¸ê±¸ allocationSizeë§Œí¼ ë¬¶ì–´ì„œ ìºì‹±
  - **DB ì‹œí€€ìŠ¤ì™€ allocationSizeëŠ” ë°˜ë“œì‹œ ë§ì¶°ì•¼ í•¨**
    - ë°ì´í„°ë² ì´ìŠ¤ ì‹œí€€ìŠ¤ ê°’ì´ í•˜ë‚˜ì”© ì¦ê°€í•˜ë„ë¡ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©´ ì´ ê°’ì„ ë°˜ë“œì‹œ 1ë¡œ ì„¤ì •

## ì‹¤ì „ ì˜ˆì œ - 1. ìš”êµ¬ì‚¬í•­ ë¶„ì„ê³¼ ê¸°ë³¸ ë§¤í•‘

- ì•„í‹°íŒ©íŠ¸(artifact)ë€ ë¹Œë“œ ê²°ê³¼ë¬¼ë¡œ ë§Œë“¤ì–´ì§€ëŠ” JAR, WAR ë“±ì˜ íŒŒì¼ ì´ë¦„
- spring bootì—ì„œëŠ” í”„ë¡œì íŠ¸ ì´ë¦„

- ì œì•½ì¡°ê±´ì€ ì—”í‹°í‹°ì— ë‹¤ ì ëŠ”ê²Œ ë‚˜ì¤‘ì— ì°¾ê¸° ì¢‹ìŒ
- DBì¹¼ëŸ¼ê³¼, ìë°” ì»¨ë²¤ì…˜ ë„¤ì´ë°ì˜ ë¶ˆì¼ì¹˜
  - ìŠ¤í”„ë§ë¶€íŠ¸ í•˜ì´ë²„ë„¤ì´íŠ¸ ì„¤ì •ì—ì„œ ê´€ë¡€ë¥¼ ë°”ê¿€ ìˆ˜ ìˆìŒ
  - **ìë°”ì˜ ì¹´ë©œì¼€ì´ìŠ¤ë¥¼ ì½ì–´ì„œ ì–¸ë”ìŠ¤ì½”ì–´ë¡œ ë¶€íŠ¸ê°€ ë°”ê¿”ì¤Œ(ê¸°ë³¸ ã„·ã„·ã„·ã„·ã„·)**

### ë°ì´í„° ì¤‘ì‹¬ ì„¤ê³„ì˜ ë¬¸ì œì 

- í˜„ì¬ ë°©ì‹ì€ ê°ì²´ ì„¤ê³„ë¥¼ í…Œì´ë¸” ì„¤ê³„ì— ë§ì¶˜ ë°©ì‹
- í…Œì´ë¸”ì˜ ì™¸ë˜í‚¤ë¥¼ ê°ì²´ì— ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜´
- ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ì´ ë¶ˆê°€ëŠ¥
- ì°¸ì¡°ê°€ ì—†ìœ¼ë¯€ë¡œ UMLë„ ì˜ëª»ë¨

# 6. ì—°ê´€ê´€ê³„ ë§¤í•‘ ê¸°ì´ˆ

- **ê°ì²´ì™€ í…Œì´ë¸” ì—°ê´€ê´€ê³„ì˜ ì°¨ì´ë¥¼ ì´í•´**
- **ê°ì²´ì˜ ì°¸ì¡°ì™€ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë¥¼ ë§¤í•‘**
- ìš©ì–´ ì´í•´
- ë°©í–¥(Direction): ë‹¨ë°©í–¥, ì–‘ë°©í–¥
- ë‹¤ì¤‘ì„±(Multiplicity): ë‹¤ëŒ€ì¼(N:1), ì¼ëŒ€ë‹¤(1:N), ì¼ëŒ€ì¼(1:1),ë‹¤ëŒ€ë‹¤(N:M) ì´í•´
- ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸(Owner): ê°ì²´ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ëŠ” ê´€ë¦¬ ì£¼ì¸ì´ í•„ìš”
  - JPAì—ì„œ ê°€ì¥ ì–´ë ¤ìš´ ë‚´ìš©

## ì—°ê´€ê´€ê³„ê°€ í•„ìš”í•œ ì´ìœ 

- â€˜ê°ì²´ì§€í–¥ ì„¤ê³„ì˜ ëª©í‘œëŠ” ììœ¨ì ì¸ ê°ì²´ë“¤ì˜ í˜‘ë ¥ ê³µë™ì²´ë¥¼ ë§Œë“œëŠ” ê²ƒì´ë‹¤.â€™ í† ë¼ì±… + ì˜¤ë¸Œì íŠ¸ ì¶”ì²œ

## ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„

### ê°ì²´ë¥¼ í…Œì´ë¸”ì— ë§ì¶”ì–´ ëª¨ë¸ë§

- (ì°¸ì¡° ëŒ€ì‹ ì— ì™¸ë˜ í‚¤ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©)
- (ì™¸ë˜ í‚¤ ì‹ë³„ìë¥¼ ì§ì ‘ ë‹¤ë£¸)

### ê°ì²´ë¥¼ í…Œì´ë¸”ì— ë§ì¶”ì–´ ë°ì´í„° ì¤‘ì‹¬ìœ¼ë¡œ ëª¨ë¸ë§í•˜ë©´, í˜‘ë ¥ ê´€ê³„ë¥¼ ë§Œë“¤ ìˆ˜ ì—†ë‹¤.

- í…Œì´ë¸”ì€ ì™¸ë˜ í‚¤ë¡œ ì¡°ì¸ì„ ì‚¬ìš©í•´ì„œ ì—°ê´€ëœ í…Œì´ë¸”ì„ ì°¾ëŠ”ë‹¤.
- ê°ì²´ëŠ” ì°¸ì¡°ë¥¼ ì‚¬ìš©í•´ì„œ ì—°ê´€ëœ ê°ì²´ë¥¼ ì°¾ëŠ”ë‹¤.
- í…Œì´ë¸”ê³¼ ê°ì²´ ì‚¬ì´ì—ëŠ” ì´ëŸ° í° ê°„ê²©ì´ ìˆë‹¤.

## ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ì™€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ 1- ê¸°ë³¸

- ê°•ì˜ì¤‘ ê°€ì¥ ì¤‘ìš”í•œ ì‹œì 
  - ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ë©”ì»¤ë‹ˆì¦˜
  - ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ì™€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸

### ì–‘ë°©í–¥ ë§¤í•‘

- **í…Œì´ë¸”ì˜ ì—°ê´€ê´€ê³„ëŠ” ì™¸ë˜í‚¤ í•˜ë‚˜ë¡œ ì–‘ë°©í–¥ì´ ë‹¤ìˆë‹¤**
  - ë°©í–¥ì´ë¼ëŠ”ê²Œ ì—†ìŒ í¬ë¦°í‚¤ í•˜ë‚˜ë©´ ì–‘ìª½ë‹¤ í™•ì¸ê°€ëŠ¥
- í•˜ì§€ë§Œ ê°ì²´ëŠ” ê·¸ë ‡ì§€ ì•ŠìŒ

- `@OneToMany(mappedBy = "team")`

  - ì–‘ë°©í–¥ ê´€ê³„ì—ì„œ ë°˜ëŒ€í¸ ì–´ë””ì— ê±¸ë ¤ìˆëŠ”ì§€

- **ê°ì²´ëŠ” ê°€ê¸‰ì  ë‹¨ë°©í–¥ì´ ì¢‹ë‹¤**
  - ì–‘ë°©í–¥ì€ ì‹ ê²½ì“¸ê²Œ ë§ìŒ

### ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ê³¼ mappedBy

- mappedBy = JPAì˜ ë©˜íƒˆë¶•ê´´ ë‚œì´ë„
- mappedByëŠ” ì²˜ìŒì—ëŠ” ì´í•´í•˜ê¸° ì–´ë µë‹¤.
- **ê°ì²´ì™€ í…Œì´ë¸”ê°„ì— ì—°ê´€ê´€ê³„ë¥¼ ë§ºëŠ” ì°¨ì´ë¥¼ ì´í•´í•´ì•¼ í•œë‹¤.**

### ê°ì²´ì™€ í…Œì´ë¸”ì´ ê´€ê³„ë¥¼ ë§ºëŠ” ì°¨ì´

- ê°ì²´ ì—°ê´€ê´€ê³„ = 2ê°œ
- íšŒì› -> íŒ€ ì—°ê´€ê´€ê³„ 1ê°œ(ë‹¨ë°©í–¥)
- íŒ€ -> íšŒì› ì—°ê´€ê´€ê³„ 1ê°œ(ë‹¨ë°©í–¥)
- í…Œì´ë¸” ì—°ê´€ê´€ê³„ = 1ê°œ
- íšŒì› <-> íŒ€ì˜ ì—°ê´€ê´€ê³„ 1ê°œ(ì–‘ë°©í–¥)

### ê°ì²´ì˜ ì–‘ë°©í–¥ ê´€ê³„

- ê°ì²´ì˜ ì–‘ë°©í–¥ ê´€ê³„ëŠ” ì‚¬ì‹¤ ì–‘ë°©í–¥ ê´€ê³„ê°€ ì•„ë‹ˆë¼ ì„œë¡œ ë‹¤ë¥¸ ë‹¨ë±¡í–¥ ê´€ê³„ 2ê°œë‹¤.
- ê°ì²´ë¥¼ ì–‘ë°©í–¥ìœ¼ë¡œ ì°¸ì¡°í•˜ë ¤ë©´ ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ë¥¼ 2ê°œ ë§Œë“¤ì–´ì•¼ í•œë‹¤.

### í…Œì´ë¸”ì˜ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„

- í…Œì´ë¸”ì€ ì™¸ë˜ í‚¤ í•˜ë‚˜ë¡œ ë‘ í…Œì´ë¸”ì˜ ì—°ê´€ê´€ê³„ë¥¼ ê´€ë¦¬
- MEMBER.TEAM_ID ì™¸ë˜ í‚¤ í•˜ë‚˜ë¡œ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ ê°€ì§(ì–‘ìª½ìœ¼ë¡œ ì¡°ì¸í•  ìˆ˜ ìˆë‹¤.)
- ë‘˜ ì¤‘ í•˜ë‚˜ë¡œ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•´ì•¼ í•œë‹¤.

### ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸(Owner)

ì–‘ë°©í–¥ ë§¤í•‘ ê·œì¹™

- ê°ì²´ì˜ ë‘ ê´€ê³„ì¤‘ í•˜ë‚˜ë¥¼ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ìœ¼ë¡œ ì§€ì •
- **ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ë§Œì´ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬(ë“±ë¡, ìˆ˜ì •)**
- **ì£¼ì¸ì´ ì•„ë‹Œìª½ì€ ì½ê¸°ë§Œ ê°€ëŠ¥**
- **ì£¼ì¸ì€ mappedBy ì†ì„± ì‚¬ìš©X**
- ì£¼ì¸ì´ ì•„ë‹ˆë©´ mappedBy ì†ì„±ìœ¼ë¡œ ì£¼ì¸ ì§€ì •
- ëˆ„êµ¬ë¥¼ ì£¼ì¸ìœ¼ë¡œ?

  - **ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ìˆëŠ” ê³³ì„ ì£¼ì¸ìœ¼ë¡œ ì •í•´ë¼**
  - ì—¬ê¸°ì„œëŠ” Member.teamì´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸

- teamì—ì„œ membersì˜ íŠ¹ì • member ê°’ì„ ë°”ê¾¼ë‹¤ë©´?
  - teamì˜ ì†ì„±ì„ ë³€ê²½í–ˆëŠ”ë° ë‹¤ë¥¸ í…Œì´ë¸”ë¡œ updateì¿¼ë¦¬ê°€ ë‚˜ê°
  - ê·¸ë˜ì„œ read-only
- ì¿¼ë¦¬ë¡œ ì¸í•œ ì„±ëŠ¥ì´ìŠˆë„ ìˆìŒ

- ë””ë¹„ì˜ ì…ì¥ì—ì„œë„ ì™¸ë˜í‚¤ê°€ í…Œì´ë¸”ì´ N, ì—†ëŠ” í…Œì´ë¸”ì´ 1

í•µì‹¬ ë¬¸ì œ:
**ê°ì²´ ì„¸ê³„(object model)**ëŠ” ì–‘ë°©í–¥ ì°¸ì¡°ê°€ ê°€ëŠ¥í•¨ (Order â†’ Member, Member â†’ Order)

**í•˜ì§€ë§Œ ë°ì´í„°ë² ì´ìŠ¤ ì„¸ê³„(DB model)**ì—ì„œëŠ” **ì™¸ë˜ í‚¤(FK)**ëŠ” í•œ ìª½ í…Œì´ë¸”ì—ë§Œ ì¡´ì¬

ì¦‰, DBì—ëŠ” ê´€ê³„ê°€ í•­ìƒ ë‹¨ë°©í–¥ì´ê³ , **ì™¸ë˜ í‚¤ë¥¼ ê°€ì§„ ìª½ì´ ê´€ê³„ë¥¼ "ì†Œìœ "**í•¨

ê·¸ë˜ì„œ JPAì—ì„œëŠ” ë‘˜ ì¤‘ í•˜ë‚˜ë¥¼ "ì£¼ì¸"ìœ¼ë¡œ ì§€ì •í•˜ê³ , ì£¼ì¸ë§Œ ì™¸ë˜ í‚¤ë¥¼ ë“±ë¡/ìˆ˜ì •/ì‚­ì œí•  ìˆ˜ ìˆê²Œ í•¨

### ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸(Owner) ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ìˆëŠ” ê³³

## ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ì™€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ 2 - ì£¼ì˜ì , ì •ë¦¬

- ì–‘ë°©í–¥ ë§¤í•‘ì‹œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì— ê°’ì„ ì…ë ¥í•´ì•¼ í•œë‹¤.
- ìˆœìˆ˜í•œ ê°ì²´ ê´€ê³„ë¥¼ ê³ ë ¤í•˜ë©´ í•­ìƒ ì–‘ìª½ë‹¤ ê°’ì„ ì…ë ¥í•´ì•¼ í•œë‹¤.
- ì–‘ë°©í–¥ ë§¤í•‘ì‹œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì— ê°’ì„ ì…ë ¥í•´ì•¼ í•œë‹¤. (ìˆœìˆ˜í•œ ê°ì²´ ê´€ê³„ë¥¼ ê³ ë ¤í•˜ë©´ í•­ìƒ ì–‘ìª½ë‹¤ ê°’ì„ ì…ë ¥í•´ì•¼ í•œë‹¤.)

### ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ ì£¼ì˜ - ì‹¤ìŠµ(ì—¬ê¸°ê¹Œì§€ í•˜ë©´ ì‹¤ë¬´ ok)

- ìˆœìˆ˜ ê°ì²´ ìƒíƒœë¥¼ ê³ ë ¤í•´ì„œ í•­ìƒ ì–‘ìª½ì— ê°’ì„ ì„¤ì •í•˜ì
- getter, setter ë•Œë¬¸ì— ë¡œì§ì´ ë“¤ì–´ê°€ë©´ `change` ë¥¼ ì‚¬ìš©í•¨ - ì˜í•œìŒ¤
- ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œë¥¼ ìƒì„±í•˜ì
  - ì–‘ìª½ì— ìˆìœ¼ë©´ ë¬¸ì œ ìƒê¸¸ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— í•œìª½ë§Œ ì„¤ì •í•˜ì.

```java
public void changeTeam(Team team) {
  this.team = team;
  team.getMembers().add(this);
}
```

---

- ì–‘ë°©í–¥ ë§¤í•‘ì‹œì— ë¬´í•œ ë£¨í”„ë¥¼ ì¡°ì‹¬í•˜ì
- ì˜ˆ: toString(), lombok, JSON ìƒì„± ë¼ì´ë¸ŒëŸ¬ë¦¬
  - member.toString() -> team.toString()
  - ì–‘ìª½ì„ ë¬´í•œí˜¸ì¶œ
  - JSON ì—­ì‹œ ë§ˆì°¬ê°€ì§€
  - ê°€ëŠ¥í•œ ë¡¬ë³µ toStringì€ ì“°ì§€ë§ˆë¼

### ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œëŠ” ì—”í‹°í‹°ë¥¼ ë°˜í™˜í•˜ì§€ë§ˆë¼

1. ë¬´í•œë£¨í”„ì˜ ê°€ëŠ¥ì„±
2. ì—”í‹°í‹° ë³€ê²½ë§ˆë‹¤ API ìŠ¤í™ì´ ë³€ê²½

### ì–‘ë°©í–¥ ë§¤í•‘ ì •ë¦¬

- **ë‹¨ë°©í–¥ ë§¤í•‘ë§Œìœ¼ë¡œë„ ì´ë¯¸ ì—°ê´€ê´€ê³„ ë§¤í•‘ì€ ì™„ë£Œ**
  - ì²˜ìŒì—ëŠ” ë¬´ì¡°ê±´ ë‹¨ë°©í–¥ ë§¤í•‘ìœ¼ë¡œ ì„¤ê³„ë¥¼ ì™„ë£Œí•´ë¼
- **ì–‘ë°©í–¥ ë§¤í•‘ì€ ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ ì¡°íšŒ(ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰) ê¸°ëŠ¥ì´ ì¶”ê°€ëœ ê²ƒ ë¿**
- JPQLì—ì„œ ì—­ë°©í–¥ìœ¼ë¡œ íƒìƒ‰í•  ì¼ì´ ë§ìŒ
- **ë‹¨ë°©í–¥ ë§¤í•‘ì„ ì˜ í•˜ê³  ì–‘ë°©í–¥ì€ í•„ìš”í•  ë•Œ ì¶”ê°€í•´ë„ ë¨(í…Œì´ë¸”ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŒ)**

## ì‹¤ì „ ì˜ˆì œ 2 - ì—°ê´€ê´€ê³„ ë§¤í•‘ ì‹œì‘

- ì–´ì§€ê°„í•˜ë©´ ì–‘ë°©í–¥ì€ ì•ˆí•¨
- í¬ë¦°í‚¤ë¡œ ì–‘ë°©í–¥ìœ¼ë¡œ ë‹¤ì°¾ê¸° ê°€ëŠ¥
- ê·¸ë˜ë„ ë¹„ì¦ˆë‹ˆìŠ¤ì ìœ¼ë¡œ ì˜ë¯¸ ìˆì„ ìˆ˜ë„ ìˆë‹¤
- ë©¤ë²„ë¥¼ ë³´ë©´ì„œ ë©¤ë²„ì˜ ì˜¤ë”ìŠ¤ë¥¼ êº¼ë‚¼ì¼ì´ ìˆì„ê¹Œ?
  - ë”°ë¡œ ì¡°íšŒí•´ë¼...!

# 7. ë‹¤ì–‘í•œ ì—°ê´€ê´€ê³„ ë§¤í•‘

## ì—°ê´€ê´€ê³„ ë§¤í•‘ì‹œ ê³ ë ¤ì‚¬í•­ 3ê°€ì§€

- ë‹¤ì¤‘ì„±
  - ë‹¤ëŒ€ì¼: @ManyToOne - ê°€ì¥ ë§ì´
  - ì¼ëŒ€ë‹¤: @OneToMany - í•„ìš”í•  ë•Œ
  - ì¼ëŒ€ì¼: @OneToOne - ê°€ë” ë‚˜ì˜´
  - ë‹¤ëŒ€ë‹¤: @ManyToMany - ì‹¤ë¬´ ê¸ˆì§€
  - ëŒ€ì¹­ì„±ìœ¼ë¡œ ìƒê°í•´ë¼
    - ë°˜ëŒ€ì¼€ì´ìŠ¤
- ë‹¨ë°©í–¥, ì–‘ë°©í–¥
  - í…Œì´ë¸”
    - ì™¸ë˜ í‚¤ í•˜ë‚˜ë¡œ ì–‘ìª½ ì¡°ì¸ ê°€ëŠ¥
    - ì‚¬ì‹¤ ë°©í–¥ì´ë¼ëŠ” ê°œë…ì´ ì—†ìŒ
  - ê°ì²´
    - ì°¸ì¡°ìš© í•„ë“œê°€ ìˆëŠ” ìª½ìœ¼ë¡œë§Œ ì°¸ì¡° ê°€ëŠ¥
    - í•œìª½ë§Œ ì°¸ì¡°í•˜ë©´ ë‹¨ë°©í–¥
    - ì–‘ìª½ì´ ì„œë¡œ ì°¸ì¡°í•˜ë©´ ì–‘ë°©í–¥
- ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸
  - í…Œì´ë¸”ì€ ì™¸ë˜ í‚¤ í•˜ë‚˜ë¡œ ë‘ í…Œì´ë¸”ì´ ì—°ê´€ê´€ê³„ë¥¼ ë§ºìŒ
  - ê°ì²´ ì–‘ë°©í–¥ ê´€ê³„ëŠ” A->B, B->A ì²˜ëŸ¼ ì°¸ì¡°ê°€ 2êµ°ë°
  - ê°ì²´ ì–‘ë°©í–¥ ê´€ê³„ëŠ” ì°¸ì¡°ê°€ 2êµ°ë° ìˆìŒ. ë‘˜ì¤‘ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•  ê³³ì„ ì§€ì •í•´ì•¼í•¨
  - ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸: ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•˜ëŠ” ì°¸ì¡°
  - ì£¼ì¸ì˜ ë°˜ëŒ€í¸: ì™¸ë˜ í‚¤ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŒ, ë‹¨ìˆœ ì¡°íšŒë§Œ ê°€ëŠ¥

ì—°ê´€ê´€ê³„ ì£¼ì¸ì„ ì œëŒ€ë¡œ ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´ ìƒê¸¸ ìˆ˜ ìˆëŠ” ë¬¸ì œë“¤

1. DBì— ì™¸ë˜ í‚¤ ê°’ì´ nullë¡œ ì €ì¥ë¨
2. ì–‘ìª½ ê°ì²´ ìƒíƒœëŠ” ì—°ê²°ëì§€ë§Œ DBëŠ” ë°˜ì˜ ì•ˆë¨

```java
//  ì—°ê´€ê´€ê³„ ì„¤ì • ì‹œ Best Practice
// ì–‘ë°©í–¥ ê´€ê³„ë¥¼ ì„¤ì •í•  ë•ŒëŠ” ë°˜ë“œì‹œ **ì£¼ì¸(ì™¸ë˜ í‚¤ ê°€ì§„ ìª½)**ì„ ë¨¼ì € ì„¤ì •í•˜ê³ , ë°˜ëŒ€í¸ë„ ê°™ì´ ì„¸íŒ…
public void setTeam(Team team) {
    this.team = team;
    if (!team.getMembers().contains(this)) {
        team.getMembers().add(this);
    }
}
```

## ë‹¤ëŒ€ì¼ [N:1]

- ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ìª½ì´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸
- ì–‘ìª½ì„ ì„œë¡œ ì°¸ì¡°í•˜ë„ë¡ ê°œë°œ

## ì¼ëŒ€ë‹¤ [1:N]

### ë‹¨ë°©í–¥

- í‘œì¤€ìŠ¤í™ì— ìˆì–´ ì„¤ëª…í•˜ì§€ë§Œ ì´ ëª¨ë¸ì„ ê±°ì˜ ê°€ì ¸ê°€ì§€ ì•ŠìŒ
- ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ì€ ì¼ëŒ€ë‹¤(1:N)ì—ì„œ ì¼(1)ì´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸
- í…Œì´ë¸” ì¼ëŒ€ë‹¤ ê´€ê³„ëŠ” í•­ìƒ ë‹¤(N) ìª½ì— ì™¸ë˜ í‚¤ê°€ ìˆìŒ
- ê°ì²´ì™€ í…Œì´ë¸”ì˜ ì°¨ì´ ë•Œë¬¸ì— ë°˜ëŒ€í¸ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•˜ëŠ” íŠ¹ì´í•œ êµ¬ì¡°
- @JoinColumnì„ ê¼­ ì‚¬ìš©í•´ì•¼ í•¨. **ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ì¡°ì¸ í…Œì´ë¸” ë°©ì‹ì„ ì‚¬ìš©í•¨(ì¤‘ê°„ì— í…Œì´ë¸”ì„ í•˜ë‚˜ ì¶”ê°€í•¨)**

### ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ë§¤í•‘ì˜ ë‹¨ì 

- **ì—”í‹°í‹°ê°€ ê´€ë¦¬í•˜ëŠ” ì™¸ë˜ í‚¤ê°€ ë‹¤ë¥¸ í…Œì´ë¸”ì— ìˆìŒ**
- ì—°ê´€ê´€ê³„ ê´€ë¦¬ë¥¼ ìœ„í•´ ì¶”ê°€ë¡œ UPDATE SQL ì‹¤í–‰
- **ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ë§¤í•‘ë³´ë‹¤ëŠ” ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥ ë§¤í•‘ì„ ì‚¬ìš©í•˜ì**

### ì¼ëŒ€ë‹¤ ì–‘ë°©í–¥ ì •ë¦¬

- ì´ëŸ° ë§¤í•‘ì€ ê³µì‹ì ìœ¼ë¡œ ì¡´ì¬X
- @JoinColumn(insertable=false, updatable=false)
- ì½ê¸° ì „ìš© í•„ë“œë¥¼ ì‚¬ìš©í•´ì„œ ì–‘ë°©í–¥ ì²˜ëŸ¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•
- ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥ì„ ì‚¬ìš©í•˜ì

## ì¼ëŒ€ì¼ [1:1]

- ì¼ëŒ€ì¼ ê´€ê³„ëŠ” ê·¸ ë°˜ëŒ€ë„ ì¼ëŒ€ì¼
- ì£¼ í…Œì´ë¸”ì´ë‚˜ ëŒ€ìƒ í…Œì´ë¸” ì¤‘ì— ì™¸ë˜ í‚¤ ì„ íƒ ê°€ëŠ¥
  - **ì£¼ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤**
  - ëŒ€ìƒ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤
- ì™¸ë˜ í‚¤ì— ë°ì´í„°ë² ì´ìŠ¤ ìœ ë‹ˆí¬(UNI) ì œì•½ì¡°ê±´ ì¶”ê°€

- ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥ ë§¤í•‘ ì²˜ëŸ¼ ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ê³³ì´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸
- ë°˜ëŒ€í¸ì€ mappedBy ì ìš©

### ì¼ëŒ€ì¼ ì •ë¦¬

- ì£¼ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤
  - ì£¼ ê°ì²´ê°€ ëŒ€ìƒ ê°ì²´ì˜ ì°¸ì¡°ë¥¼ ê°€ì§€ëŠ” ê²ƒ ì²˜ëŸ¼ ì£¼ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤ë¥¼ ë‘ê³  ëŒ€ìƒ í…Œì´ë¸”ì„ ì°¾ìŒ
  - ê°ì²´ì§€í–¥ ê°œë°œì ì„ í˜¸
  - JPA ë§¤í•‘ í¸ë¦¬
  - ì¥ì : ì£¼ í…Œì´ë¸”ë§Œ ì¡°íšŒí•´ë„ ëŒ€ìƒ í…Œì´ë¸”ì— ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸ ê°€ëŠ¥
  - ë‹¨ì : ê°’ì´ ì—†ìœ¼ë©´ ì™¸ë˜ í‚¤ì— null í—ˆìš©
- ëŒ€ìƒ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤

  - ëŒ€ìƒ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤ê°€ ì¡´ì¬
  - ì „í†µì ì¸ ë°ì´í„°ë² ì´ìŠ¤ ê°œë°œì ì„ í˜¸
  - ì¥ì : ì£¼ í…Œì´ë¸”ê³¼ ëŒ€ìƒ í…Œì´ë¸”ì„ ì¼ëŒ€ì¼ì—ì„œ ì¼ëŒ€ë‹¤ ê´€ê³„ë¡œ ë³€ê²½í•  ë•Œ í…Œì´ë¸” êµ¬ì¡° ìœ ì§€
  - ë‹¨ì : í”„ë¡ì‹œ ê¸°ëŠ¥ì˜ í•œê³„ë¡œ **ì§€ì—° ë¡œë”©ìœ¼ë¡œ ì„¤ì •í•´ë„ í•­ìƒ ì¦‰ì‹œ ë¡œë”©ë¨**(í”„ë¡ì‹œëŠ” ë’¤ì—ì„œ ì„¤ëª…)

- ë„ˆë¬´ ë¨¼ ë¯¸ë˜ë¥¼ ìƒê°í•˜ì§€ ì•ŠëŠ”ë‹¤.

## ë‹¤ëŒ€ë‹¤ [N:M]

- **ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì •ê·œí™”ëœ í…Œì´ë¸” 2ê°œë¡œ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ í‘œí˜„í•  ìˆ˜ ì—†ìŒ**
- **ì—°ê²° í…Œì´ë¸”ì„ ì¶”ê°€í•´ì„œ ì¼ëŒ€ë‹¤, ë‹¤ëŒ€ì¼ ê´€ê³„ë¡œ í’€ì–´ë‚´ì•¼í•¨**
- **ê°ì²´ëŠ” ì»¬ë ‰ì…˜ì„ ì‚¬ìš©í•´ì„œ ê°ì²´ 2ê°œë¡œ ë‹¤ëŒ€ë‹¤ ê´€ê³„ ê°€ëŠ¥**
- @ManyToMany ì‚¬ìš©
- @JoinTableë¡œ ì—°ê²° í…Œì´ë¸” ì§€ì •
- ë‹¤ëŒ€ë‹¤ ë§¤í•‘: ë‹¨ë°©í–¥, ì–‘ë°©í–¥ ê°€ëŠ¥

### ë‹¤ëŒ€ë‹¤ ë§¤í•‘ì˜ í•œê³„

- í¸ë¦¬í•´ ë³´ì´ì§€ë§Œ ì‹¤ë¬´ì—ì„œ ì‚¬ìš©X
- ì—°ê²° í…Œì´ë¸”ì´ ë‹¨ìˆœíˆ ì—°ê²°ë§Œ í•˜ê³  ëë‚˜ì§€ ì•ŠìŒ
- ì£¼ë¬¸ì‹œê°„, ìˆ˜ëŸ‰ ê°™ì€ ë°ì´í„°ê°€ ë“¤ì–´ì˜¬ ìˆ˜ ìˆìŒ

### ë‹¤ëŒ€ë‹¤ í•œê³„ ê·¹ë³µ

- **ì—°ê²° í…Œì´ë¸”ìš© ì—”í‹°í‹° ì¶”ê°€(ì—°ê²° í…Œì´ë¸”ì„ ì—”í‹°í‹°ë¡œ ìŠ¹ê²©)**
- @ManyToMany -> @OneToMany, @ManyToOne

### JPAì—ì„œëŠ” @ManyToManyë¥¼ ì“°ë©´ ìë™ìœ¼ë¡œ ì¡°ì¸ í…Œì´ë¸”ì„ ë§Œë“¤ì–´ì„œ N:M ê´€ê³„ë¥¼ ì²˜ë¦¬í•˜ì§€ë§Œ ê¶Œì¥í•˜ì§€ ì•ŠëŠ” ì´ìœ 

1. ì—°ê²° í…Œì´ë¸”ì— ì¶”ê°€ ì†ì„±ì„ ë„£ì„ ìˆ˜ ì—†ìŒ
2. ì—°ê´€ê´€ê³„ ì£¼ì¸ ì œì–´ê°€ ë¶ˆí¸í•¨ - ì¤‘ê°„ í…Œì´ë¸”ì— ì ‘ê·¼í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ì»¤ìŠ¤í„°ë§ˆì´ì§•ì´ ì œí•œë¨
3. ì‚­ì œ, ì—…ë°ì´íŠ¸ ì‹œ ì œì–´ê°€ ì–´ë µë‹¤ - ì¤‘ê°„ í…Œì´ë¸”ë§Œ ì‚­ì œí•˜ê±°ë‚˜ ê´€ë¦¬í•˜ëŠ” ê²Œ ë²ˆê±°ë¡­ê±°ë‚˜ ë¶ˆê°€ëŠ¥í•œ ìƒí™©ì´ ìƒê¹€
4. í™•ì¥ì„± & ìœ ì§€ë³´ìˆ˜ ë¬¸ì œ - ì—°ê²° í…Œì´ë¸”ì´ ë‹¨ìˆœí•  ë•ŒëŠ” ê´œì°®ì§€ë§Œ, ì‹¤ë¬´ëŠ” ë³€í•˜ì§€ ì•ŠëŠ” ë‹¨ìˆœí•¨ì€ ê±°ì˜ ì—†ìŒ

ë‚˜ì¤‘ì— ì†ì„± ì¶”ê°€í•˜ë ¤ë©´ ê²°êµ­ @ManyToMany â†’ ì—”í‹°í‹°ë¡œ ìŠ¹ê²© í•´ì•¼ í•¨ â†’ ë¦¬íŒ©í† ë§ ì§€ì˜¥

---

## âœ… ì •ê·œí™”ë¥¼ ì‰½ê²Œ ë§í•˜ë©´?

> **"ì¤‘ë³µ ì—†ì´, ë°ì´í„°ê°€ ì´ìƒí•˜ì§€ ì•Šê²Œ, ë³€ê²½ì— ê°•í•˜ê²Œ ë§Œë“œëŠ” ë°ì´í„° ë¶„ë¦¬ ê³µì‹"**
> â¡ï¸ **ì •ê·œí™”ëŠ” ì´ëŸ° ë¹„íš¨ìœ¨ê³¼ ì¤‘ë³µì„ ì—†ì• ëŠ” ë°©ë²•**

### ğŸ” ì •ê·œí™” ë‹¨ê³„ ìš”ì•½ (ì‰½ê²Œ!)

| ë‹¨ê³„  | ì´ë¦„        | ì‰½ê²Œ ë§í•˜ë©´                          | ëª©ì                   |
| ----- | ----------- | ------------------------------------ | --------------------- |
| 1NF   | ì œ1ì •ê·œí˜•   | **ì…€ ì•ˆì— ê°’ì€ í•˜ë‚˜ë§Œ!** ë¦¬ìŠ¤íŠ¸ ì•ˆë¨ | ì›ìì„± í™•ë³´           |
| 2NF   | ì œ2ì •ê·œí˜•   | **ì¤‘ë³µ ë°ì´í„°ëŠ” ë”°ë¡œ ë¹¼ì!**         | ë¶€ë¶„ ì¢…ì† ì œê±°        |
| 3NF   | ì œ3ì •ê·œí˜•   | **ì£¼ì œ ë²—ì–´ë‚œ ì •ë³´ëŠ” ë‚˜ëˆ ë¼!**       | ì´í–‰ ì¢…ì† ì œê±°        |
| BCNF~ | ê³ ê¸‰ ì •ê·œí˜• | ê±°ì˜ ì•ˆ ì”€                           | íŠ¹ë³„í•œ ì¢…ì† ê´€ê³„ ì œê±° |

---

### ğŸ§ª ì‹¤ë¬´ì—ì„œëŠ” ì–´ë””ê¹Œì§€ ì“°ëƒ -> ğŸ’¼ ë³´í†µ ì‹¤ë¬´ì—ì„œëŠ”:

- **3NF (ì œ3ì •ê·œí˜•)**ê¹Œì§€ë§Œ ì ìš©í•˜ëŠ” ê²½ìš°ê°€ ë§ê³ 
- ë•Œë¡œëŠ” **"ì•½ê°„ ì •ê·œí™”ë¥¼ ê¹¨ëŠ”"** ë¹„ì •ê·œí™”ë„ ì¼ë¶€ëŸ¬ í•¨ (ì†ë„, ë‹¨ìˆœí™” ëª©ì )

| ì •ê·œí™”ëŠ”... | ì„¤ëª…                                              |
| ----------- | ------------------------------------------------- |
| ë¬´ì—‡ì¸ê°€?   | ì¤‘ë³µ ì œê±° + ë³€ê²½ì— ê°•í•œ êµ¬ì¡°ë¡œ í…Œì´ë¸” ë‚˜ëˆ„ëŠ” ê¸°ë²• |
| ì™œ í•˜ëŠ”ê°€?  | ë¬´ê²°ì„± ìœ ì§€, í™•ì¥ì„± í™•ë³´, ì¤‘ë³µ ìµœì†Œí™”             |
| ì‹¤ë¬´ì—ì„œëŠ”? | ë³´í†µ 3NFê¹Œì§€, í•„ìš”ì‹œ ì¼ë¶€ ë¹„ì •ê·œí™”                |
| ì‹¤ìˆ˜í•˜ë©´?   | ì¤‘ë³µ, ì‚­ì œ ì´ìƒ, ì‚½ì… ì´ìƒ, ì„±ëŠ¥ ë¬¸ì œ ë°œìƒ ê°€ëŠ¥   |

# 8. ê³ ê¸‰ ë§¤í•‘

## ìƒì†ê´€ê³„ ë§¤í•‘

- ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ëŠ” ìƒì† ê´€ê³„X
- **ìŠˆí¼íƒ€ì… ì„œë¸Œíƒ€ì… ê´€ê³„ë¼ëŠ” ëª¨ë¸ë§ ê¸°ë²•ì´ ê°ì²´ ìƒì†ê³¼ ìœ ì‚¬**
- í•´ë‹¹ ëª¨ë¸ë§ ê¸°ë²•ì„ DBì—ì„œ êµ¬í˜„í•˜ëŠ” ì„¸ê°€ì§€ ë°©ë²•

- **ì¡°ì¸ì„ ê¸°ë³¸ìœ¼ë¡œ, ì •ë§ ë‹¨ìˆœí•˜ë©´ ë‹¨ì¼ë¡œ ê°€ë¼**

### ìƒì†ê´€ê³„ ë§¤í•‘: ê°ì²´ì˜ ìƒì†ê³¼ êµ¬ì¡°ì™€ DBì˜ ìŠˆí¼íƒ€ì… ì„œë¸Œíƒ€ì… ê´€ê³„ë¥¼ ë§¤í•‘

- ìŠˆí¼íƒ€ì… ì„œë¸Œíƒ€ì… ë…¼ë¦¬ ëª¨ë¸ì„ ì‹¤ì œ ë¬¼ë¦¬ ëª¨ë¸ë¡œ êµ¬í˜„í•˜ëŠ” ë°©ë²•
- ê°ê° í…Œì´ë¸”ë¡œ ë³€í™˜ -> ì¡°ì¸ ì „ëµ
- í†µí•© í…Œì´ë¸”ë¡œ ë³€í™˜ -> ë‹¨ì¼ í…Œì´ë¸” ì „ëµ
- ì„œë¸Œíƒ€ì… í…Œì´ë¸”ë¡œ ë³€í™˜ -> êµ¬í˜„ í´ë˜ìŠ¤ë§ˆë‹¤ í…Œì´ë¸” ì „ëµ

### ì£¼ìš” ì–´ë…¸í…Œì´ì…˜

- `@Inheritance(strategy=InheritanceType.XXX)`
  - JOINED: ì¡°ì¸ ì „ëµ - JPAì™€ ê°€ì¥ ìœ ì‚¬í•¨
  - SINGLE_TABLE: ë‹¨ì¼ í…Œì´ë¸” ì „ëµ
  - TABLE_PER_CLASS: êµ¬í˜„ í´ë˜ìŠ¤ë§ˆë‹¤ í…Œì´ë¸” ì „ëµ
- `@DiscriminatorColumn(name=â€œDTYPEâ€)`
  - ìš´ì˜ì—ì„œëŠ” ìˆëŠ”ê²Œ ì¢‹ë‹¤
- `@DiscriminatorValue(â€œXXXâ€)`

- ê·¸ëƒ¥ ìƒì†í•˜ë©´ í•œí…Œì´ë¸”ì— ë‹¤ ë–„ë ¤ë°•ìŒ -> ë‹¨ì¼ í…Œì´ë¸” ì „ëµ
- ì–´ë…¸í…Œì´ì…˜ë§Œ ë°”ê¾¸ë©´, DBê°€ ë³€ê²½ë˜ì–´ë„ ì½”ë“œì˜ ë³€ê²½ì´ ê±°ì˜ì—†ë‹¤.

### ì¡°ì¸ ì „ëµ

**ì •ì„ì´ë¼ê³  ë³´ë©´ ëœë‹¤.**

- ì¥ì 
  - **í…Œì´ë¸” ì •ê·œí™”**
  - **ì™¸ë˜ í‚¤ ì°¸ì¡° ë¬´ê²°ì„± ì œì•½ì¡°ê±´ í™œìš©ê°€ëŠ¥**
  - ì €ì¥ê³µê°„ íš¨ìœ¨í™”
- ë‹¨ì 
  - ì¡°íšŒì‹œ ì¡°ì¸ì„ ë§ì´ ì‚¬ìš©, ì„±ëŠ¥ ì €í•˜
  - ì¡°íšŒ ì¿¼ë¦¬ê°€ ë³µì¡í•¨
  - ë°ì´í„° ì €ì¥ì‹œ INSERT SQL 2ë²ˆ í˜¸ì¶œ
    - í° ë‹¨ì ì€ ì•„ë‹ˆë‹¤

### ë‹¨ì¼ í…Œì´ë¸” ì „ëµ

dTypeì´ ê¸°ë³¸

- ì¥ì 
  - **ì¡°ì¸ì´ í•„ìš” ì—†ìœ¼ë¯€ë¡œ ì¼ë°˜ì ìœ¼ë¡œ ì¡°íšŒ ì„±ëŠ¥ì´ ë¹ ë¦„**
  - **ì¡°íšŒ ì¿¼ë¦¬ê°€ ë‹¨ìˆœí•¨**
- ë‹¨ì 
  - ìì‹ ì—”í‹°í‹°ê°€ ë§¤í•‘í•œ ì»¬ëŸ¼ì€ ëª¨ë‘ null í—ˆìš©
    - ì¹˜ëª…ì 
  - ë‹¨ì¼ í…Œì´ë¸”ì— ëª¨ë“  ê²ƒì„ ì €ì¥í•˜ë¯€ë¡œ í…Œì´ë¸”ì´ ì»¤ì§ˆ ìˆ˜ ìˆë‹¤.
    - ìƒí™©ì— ë”°ë¼ì„œ ì¡°íšŒ ì„±ëŠ¥ì´ ì˜¤íˆë ¤ ëŠë ¤ì§ˆ ìˆ˜ ìˆë‹¤.
    - ì„ê³„ì ì„ ë„˜ì–´ì•¼í•˜ëŠ”ë° ì´ëŸ°ê²½ìš°ëŠ” ì‚¬ì‹¤ ê±°ì˜ ì—†ë‹¤

### êµ¬í˜„ í´ë˜ìŠ¤ë§ˆë‹¤ í…Œì´ë¸” ì „ëµ

- **ì´ ì „ëµì€ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ìì™€ ORM ì „ë¬¸ê°€ ë‘˜ ë‹¤ ì¶”ì²œX**
  - **ì“°ì§€ë§ˆë¼!!!!**
  - ì°¾ì„ë•Œê°€ ë¬¸ì œ union allë¡œ ë‹¤ë’¤ì§
- ì¥ì 
  - ì„œë¸Œ íƒ€ì…ì„ ëª…í™•í•˜ê²Œ êµ¬ë¶„í•´ì„œ ì²˜ë¦¬í•  ë•Œ íš¨ê³¼ì 
    - ì¸ì„¤íŠ¸, ì…€ë ‰íŠ¸ì—ì„  ì¢‹ì„ ìˆ˜ ìˆìŒ
  - not null ì œì•½ì¡°ê±´ ì‚¬ìš© ê°€ëŠ¥
- ë‹¨ì 
  - ì—¬ëŸ¬ ìì‹ í…Œì´ë¸”ì„ í•¨ê»˜ ì¡°íšŒí•  ë•Œ ì„±ëŠ¥ì´ ëŠë¦¼(UNION SQL í•„ìš”)
    - ì¹˜ëª…ì 
  - ìì‹ í…Œì´ë¸”ì„ í†µí•©í•´ì„œ ì¿¼ë¦¬í•˜ê¸° ì–´ë ¤ì›€
    - ì¹˜ëª…ì 
  - ë³€ê²½í•˜ê¸°ê°€ ì–´ë ¤ì›€

## Mapped Superclass - ë§¤í•‘ ì •ë³´ ìƒì†

- ê³µí†µ ë§¤í•‘ ì •ë³´ê°€ í•„ìš”í•  ë•Œ ì‚¬ìš©(id, name)
- ìƒì†ê´€ê³„ ë§¤í•‘X
- ì—”í‹°í‹°X, í…Œì´ë¸”ê³¼ ë§¤í•‘X
- **ë¶€ëª¨ í´ë˜ìŠ¤ë¥¼ ìƒì† ë°›ëŠ” ìì‹ í´ë˜ìŠ¤ì— ë§¤í•‘ ì •ë³´ë§Œ ì œê³µ**
- ì¡°íšŒ, ê²€ìƒ‰ ë¶ˆê°€(em.find(BaseEntity) ë¶ˆê°€)
- **ì§ì ‘ ìƒì„±í•´ì„œ ì‚¬ìš©í•  ì¼ì´ ì—†ìœ¼ë¯€ë¡œ ì¶”ìƒ í´ë˜ìŠ¤ ê¶Œì¥**

- í…Œì´ë¸”ê³¼ ê´€ê³„ ì—†ê³ , ë‹¨ìˆœíˆ ì—”í‹°í‹°ê°€ ê³µí†µìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ë§¤í•‘ì •ë³´ë¥¼ ëª¨ìœ¼ëŠ” ì—­í• 
- ì£¼ë¡œ ë“±ë¡ì¼, ìˆ˜ì •ì¼, ë“±ë¡ì, ìˆ˜ì •ì ê°™ì€ ì „ì²´ ì—”í‹°í‹°ì—ì„œ ê³µí†µìœ¼ë¡œ ì ìš©í•˜ëŠ” ì •ë³´ë¥¼ ëª¨ì„ ë•Œ ì‚¬ìš©
- **ì°¸ê³ : @Entity í´ë˜ìŠ¤ëŠ” ì—”í‹°í‹°ë‚˜ @MappedSuperclassë¡œ ì§€ì •í•œ í´ë˜ìŠ¤ë§Œ ìƒì† ê°€ëŠ¥**

## ì‹¤ì „ ì˜ˆì œ 4 - ìƒì†ê´€ê³„ ë§¤í•‘

- JPAì—ì„œ ì˜ì†í•˜ê¸° ì§ì „ íŠ¹ì • ë©”ì„œë“œ í˜¸ì¶œ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ìƒì„±ì‹œê°„ ê°™ì€ ê°’ ì±„ìš°ê¸°ê°€ëŠ¥
- ì‹¤ì „ì—ì„œ ìƒì†ê´€ê³„ë¥¼ ì“°ëŠëƒ?
  - ë…¸ê°€ë‹¤ë¥¼ í•˜ë”ë¼ë„ ë³µì¡ë„ë¥¼ ê´€ë¦¬í•˜ëŠ” ì¸¡ë©´ì—ì„œ ì•ˆë‚˜ëˆ„ëŠ”ê²Œ ë°©ë²•ì¼ ìˆ˜ë„ ìˆìŒ
  - ìƒì†ê´€ê³„ë¡œ ì‚¬ìš©í•˜ë‹¤ ë°ì´í„°ì–‘ì´ ë„ˆë¬´ ë§ì•„ì§€ì, ë³µì¡í•´ì„œ í…Œì´ë¸”ì„ ë‹¨ìˆœí•˜ê²Œ ê´€ë¦¬í•˜ê¸°ë„ í•¨

# 9. í”„ë¡ì‹œì™€ ì—°ê´€ê´€ê³„ ê´€ë¦¬

## ëª©ì°¨

â€¢ í”„ë¡ì‹œ
â€¢ ì¦‰ì‹œ ë¡œë”©ê³¼ ì§€ì—° ë¡œë”©
â€¢ ì§€ì—° ë¡œë”© í™œìš©
â€¢ ì˜ì†ì„± ì „ì´: CASCADE
â€¢ ê³ ì•„ ê°ì²´
â€¢ ì˜ì†ì„± ì „ì´ + ê³ ì•„ ê°ì²´, ìƒëª…ì£¼ê¸°
â€¢ ì‹¤ì „ ì˜ˆì œ - 5.ì—°ê´€ê´€ê³„ ê´€ë¦¬

## í”„ë¡ì‹œ

### í”„ë¡ì‹œ ê¸°ì´ˆ

- em.find() vs em.getReference()
- em.find(): ë°ì´í„°ë² ì´ìŠ¤ë¥¼ í†µí•´ì„œ ì‹¤ì œ ì—”í‹°í‹° ê°ì²´ ì¡°íšŒ
- em.getReference(): ë°ì´í„°ë² ì´ìŠ¤ ì¡°íšŒë¥¼ ë¯¸ë£¨ëŠ” ê°€ì§œ(í”„ë¡ì‹œ) ì—”í‹°í‹° ê°ì²´ ì¡°íšŒ

### í”„ë¡ì‹œ íŠ¹ì§•

- ì‹¤ì œ í´ë˜ìŠ¤ë¥¼ ìƒì† ë°›ì•„ì„œ ë§Œë“¤ì–´ì§
- ì‹¤ì œ í´ë˜ìŠ¤ì™€ ê²‰ ëª¨ì–‘ì´ ê°™ë‹¤.
- ì‚¬ìš©í•˜ëŠ” ì…ì¥ì—ì„œëŠ” ì§„ì§œ ê°ì²´ì¸ì§€ í”„ë¡ì‹œ ê°ì²´ì¸ì§€ êµ¬ë¶„í•˜ì§€ ì•Šê³  ì‚¬ìš©í•˜ë©´ ë¨(ì´ë¡ ìƒ)
- í”„ë¡ì‹œ ê°ì²´ëŠ” ì‹¤ì œ ê°ì²´ì˜ ì°¸ì¡°(target)ë¥¼ ë³´ê´€
- í”„ë¡ì‹œ ê°ì²´ë¥¼ í˜¸ì¶œí•˜ë©´ í”„ë¡ì‹œ ê°ì²´ëŠ” ì‹¤ì œ ê°ì²´ì˜ ë©”ì†Œë“œ í˜¸ì¶œ

- í”„ë¡ì‹œ ê°ì²´ëŠ” ì²˜ìŒ ì‚¬ìš©í•  ë•Œ í•œ ë²ˆë§Œ ì´ˆê¸°í™”
- **í”„ë¡ì‹œ ê°ì²´ë¥¼ ì´ˆê¸°í™” í•  ë•Œ, í”„ë¡ì‹œ ê°ì²´ê°€ ì‹¤ì œ ì—”í‹°í‹°ë¡œ ë°”ë€ŒëŠ” ê²ƒì€ ì•„ë‹˜**
  - ì´ˆê¸°í™”ë˜ë©´ í”„ë¡ì‹œ ê°ì²´ë¥¼ í†µí•´ì„œ ì‹¤ì œ ì—”í‹°í‹°ì— ì ‘ê·¼ ê°€ëŠ¥
- **ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì°¾ëŠ” ì—”í‹°í‹°ê°€ ì´ë¯¸ ìˆìœ¼ë©´ em.getReference()ë¥¼ í˜¸ì¶œí•´ë„ ì‹¤ì œ ì—”í‹°í‹° ë°˜í™˜**
- í”„ë¡ì‹œ ê°ì²´ëŠ” ì›ë³¸ ì—”í‹°í‹°ë¥¼ ìƒì†ë°›ìŒ, ë”°ë¼ì„œ íƒ€ì… ì²´í¬ì‹œ ì£¼ì˜í•´ì•¼í•¨
  - (== ë¹„êµ ì‹¤íŒ¨, ëŒ€ì‹  instance of ì‚¬ìš©)
  - ì‹¤ë¬´ì—ì„œ ì´ëŸ´ì¼ì´ ìˆì„ê¹Œ...?
- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ë„ì›€ì„ ë°›ì„ ìˆ˜ ì—†ëŠ” ì¤€ì˜ì† ìƒíƒœì¼ ë•Œ, í”„ë¡ì‹œë¥¼ ì´ˆê¸°í™”í•˜ë©´ë¬¸ì œ ë°œìƒ
  - (í•˜ì´ë²„ë„¤ì´íŠ¸ëŠ” org.hibernate.LazyInitializationException ì˜ˆì™¸ë¥¼ í„°íŠ¸ë¦¼)

### í”„ë¡ì‹œ í™•ì¸

- í”„ë¡ì‹œ ì¸ìŠ¤í„´ìŠ¤ì˜ ì´ˆê¸°í™” ì—¬ë¶€ í™•ì¸

  - PersistenceUnitUtil.isLoaded(Object entity)

- í”„ë¡ì‹œ í´ë˜ìŠ¤ í™•ì¸ ë°©ë²•

  - entity.getClass().getName() ì¶œë ¥(..javasist.. or HibernateProxy...)

- í”„ë¡ì‹œ ê°•ì œ ì´ˆê¸°í™”

  - org.hibernate.Hibernate.initialize(entity);

- ì°¸ê³ : JPA í‘œì¤€ì€ ê°•ì œ ì´ˆê¸°í™” ì—†ìŒ
  - ê°•ì œ í˜¸ì¶œ: member.getName()

## ì¦‰ì‹œ ë¡œë”©ê³¼ ì§€ì—° ë¡œë”©

- ì§€ì—° ë¡œë”© LAZYì„ ì‚¬ìš©í•´ì„œ í”„ë¡ì‹œë¡œ ì¡°íšŒ
- ì¦‰ì‹œ ë¡œë”© EAGERë¥¼ ì‚¬ìš©í•´ì„œ í•¨ê»˜ ì¡°íšŒ

### í”„ë¡ì‹œì™€ ì¦‰ì‹œë¡œë”© ì£¼ì˜

- **ê°€ê¸‰ì  ì§€ì—° ë¡œë”©ë§Œ ì‚¬ìš©(íŠ¹íˆ ì‹¤ë¬´ì—ì„œ)**
- ì¦‰ì‹œ ë¡œë”©ì„ ì ìš©í•˜ë©´ ì˜ˆìƒí•˜ì§€ ëª»í•œ SQLì´ ë°œìƒ
- **ì¦‰ì‹œ ë¡œë”©ì€ JPQLì—ì„œ N+1 ë¬¸ì œë¥¼ ì¼ìœ¼í‚¨ë‹¤.**

  - ì¿¼ë¦¬ë¥¼ 1ê°œ ë‚ ë ¸ëŠ”ë° ì‹¤ì œë¡œ Nê°œ ë‚˜ê°
  - N + 1 ë¬¸ì œëŠ” JPAì—ì„œ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•  ë•Œ, ì˜ˆìƒë³´ë‹¤ ë” ë§ì€ SQL ì¿¼ë¦¬ê°€ ì‹¤í–‰
  - "1": ìµœì´ˆì˜ JPQL ì¿¼ë¦¬ë¡œ ì—”í‹°í‹° ëª©ë¡ì„ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬.
  - "N": ì¡°íšŒëœ ê° ì—”í‹°í‹°ì™€ ì—°ê´€ëœ ì—”í‹°í‹°(ì˜ˆ: @OneToMany, @ManyToOne)ë¥¼ ì¡°íšŒí•˜ê¸° ìœ„í•´ ì¶”ê°€ë¡œ ì‹¤í–‰ë˜ëŠ” ì¿¼ë¦¬ë“¤.

- **@ManyToOne, @OneToOneì€ ê¸°ë³¸ì´ ì¦‰ì‹œ ë¡œë”© -> LAZYë¡œ ì„¤ì •**
- @OneToMany, @ManyToManyëŠ” ê¸°ë³¸ì´ ì§€ì—° ë¡œë”©

### ì§€ì—° ë¡œë”© í™œìš© - ì‹¤ë¬´

- ëª¨ë“  ì—°ê´€ê´€ê³„ì— ì§€ì—° ë¡œë”©ì„ ì‚¬ìš©í•´ë¼!
- **ì‹¤ë¬´ì—ì„œ ì¦‰ì‹œ ë¡œë”©ì„ ì‚¬ìš©í•˜ì§€ ë§ˆë¼!**
- JPQL fetch ì¡°ì¸ì´ë‚˜, ì—”í‹°í‹° ê·¸ë˜í”„ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ë¼!(ë’¤ì—ì„œ ì„¤ëª…)
- **ì¦‰ì‹œ ë¡œë”©ì€ ìƒìƒí•˜ì§€ ëª»í•œ ì¿¼ë¦¬ê°€ ë‚˜ê°„ë‹¤.**

## ì˜ì†ì„± ì „ì´(CASCADE)ì™€ ê³ ì•„ ê°ì²´

- íŠ¹ì • ì—”í‹°í‹°ë¥¼ ì˜ì† ìƒíƒœë¡œ ë§Œë“¤ ë•Œ ì—°ê´€ëœ ì—”í‹°í‹°ë„ í•¨ê»˜ ì˜ì†ìƒíƒœë¡œ ë§Œë“¤ë„ ì‹¶ì„ ë•Œ
- ì˜ˆ: ë¶€ëª¨ ì—”í‹°í‹°ë¥¼ ì €ì¥í•  ë•Œ ìì‹ ì—”í‹°í‹°ë„ í•¨ê»˜ ì €ì¥.

### ì˜ì†ì„± ì „ì´: CASCADE - ì£¼ì˜!

- ì˜ì†ì„± ì „ì´ëŠ” ì—°ê´€ê´€ê³„ë¥¼ ë§¤í•‘í•˜ëŠ” ê²ƒê³¼ ì•„ë¬´ ê´€ë ¨ì´ ì—†ìŒ
- ì—”í‹°í‹°ë¥¼ ì˜ì†í™”í•  ë•Œ ì—°ê´€ëœ ì—”í‹°í‹°ë„ í•¨ê»˜ ì˜ì†í™”í•˜ëŠ” í¸ë¦¬í•¨ì„ ì œê³µí•  ë¿
- **ëŒ€ìƒì„ í•˜ë‚˜ì˜ ì—”í‹°í‹°ë¡œë§Œ ê´€ë¦¬í•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ë©´ ì•ˆì“°ëŠ”ê²Œ ë§ë‹¤.**
  - ì—”í‹°í‹°ì˜ ë¼ì´í”„ì‚¬ì´í´ì´ ê°™ì„ ë•Œ
  - ë‹¨ì¼ ì†Œìœ ì
    - ê²Œì‹œê¸€ê³¼ ëŒ“ê¸€

### CASCADEì˜ ì¢…ë¥˜

- **ALL: ëª¨ë‘ ì ìš©**
- **PERSIST: ì˜ì†**
- **REMOVE: ì‚­ì œ**
- MERGE: ë³‘í•©
- REFRESH: REFRESH
- DETACH: DETACH

### ê³ ì•„ ê°ì²´

- ê³ ì•„ ê°ì²´ ì œê±°: ë¶€ëª¨ ì—”í‹°í‹°ì™€ ì—°ê´€ê´€ê³„ê°€ ëŠì–´ì§„ ìì‹ ì—”í‹°í‹°ë¥¼ ìë™ìœ¼ë¡œ ì‚­ì œ
- orphanRemoval = true
- Parent parent1 = em.find(Parent.class, id);

  - parent1.getChildren().remove(0); //ìì‹ ì—”í‹°í‹°ë¥¼ ì»¬ë ‰ì…˜ì—ì„œ ì œê±°

- DELETE FROM CHILD WHERE ID=?

### ê³ ì•„ ê°ì²´ - ì£¼ì˜

- ì°¸ì¡°ê°€ ì œê±°ëœ ì—”í‹°í‹°ëŠ” ë‹¤ë¥¸ ê³³ì—ì„œ ì°¸ì¡°í•˜ì§€ ì•ŠëŠ” ê³ ì•„ ê°ì²´ë¡œë³´ê³  ì‚­ì œí•˜ëŠ” ê¸°ëŠ¥
- **ì°¸ì¡°í•˜ëŠ” ê³³ì´ í•˜ë‚˜ì¼ ë•Œ ì‚¬ìš©í•´ì•¼í•¨!**
- **íŠ¹ì • ì—”í‹°í‹°ê°€ ê°œì¸ ì†Œìœ í•  ë•Œ ì‚¬ìš©**
- @OneToOne, @OneToManyë§Œ ê°€ëŠ¥
- ì°¸ê³ : ê°œë…ì ìœ¼ë¡œ ë¶€ëª¨ë¥¼ ì œê±°í•˜ë©´ ìì‹ì€ ê³ ì•„ê°€ ëœë‹¤.
  - ë”°ë¼ì„œ ê³ ì•„ ê°ì²´ ì œê±° ê¸°ëŠ¥ì„ í™œì„±í™” í•˜ë©´, ë¶€ëª¨ë¥¼ ì œê±°í•  ë•Œ ìì‹ë„ í•¨ê»˜ ì œê±°ëœë‹¤.
  - ì´ê²ƒì€ CascadeType.REMOVEì²˜ëŸ¼ ë™ì‘í•œë‹¤.

### ì˜ì†ì„± ì „ì´ + ê³ ì•„ ê°ì²´, ìƒëª…ì£¼ê¸°

- CascadeType.ALL + orphanRemoval=true
- ìŠ¤ìŠ¤ë¡œ ìƒëª…ì£¼ê¸°ë¥¼ ê´€ë¦¬í•˜ëŠ” ì—”í‹°í‹°ëŠ” em.persist()ë¡œ ì˜ì†í™”, em.remove()ë¡œ ì œê±°
- **ë‘ ì˜µì…˜ì„ ëª¨ë‘ í™œì„±í™” í•˜ë©´ ë¶€ëª¨ ì—”í‹°í‹°ë¥¼ í†µí•´ì„œ ìì‹ì˜ ìƒëª… ì£¼ê¸°ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŒ**
- ë„ë©”ì¸ ì£¼ë„ ì„¤ê³„(DDD)ì˜ Aggregate Rootê°œë…ì„ êµ¬í˜„í•  ë•Œ ìœ ìš©

## ì‹¤ì „ ì˜ˆì œ 5 - ì—°ê´€ê´€ê³„ ê´€ë¦¬

### ê¸€ë¡œë²Œ í˜ì¹˜ ì „ëµ ì„¤ì •

- ëª¨ë“  ì—°ê´€ê´€ê³„ë¥¼ ì§€ì—° ë¡œë”©ìœ¼ë¡œ
- @ManyToOne, @OneToOneì€ ê¸°ë³¸ì´ ì¦‰ì‹œ ë¡œë”©ì´ë¯€ë¡œ ì§€ì—° ë¡œë”©ìœ¼ë¡œ ë³€ê²½

ì˜ì†ì„± ì „ì´ ì„¤ì •

- Order -> Deliveryë¥¼ ì˜ì†ì„± ì „ì´ ALL ì„¤ì •
- Order -> OrderItemì„ ì˜ì†ì„± ì „ì´ ALL ì„¤ì •
